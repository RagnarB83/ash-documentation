

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Workflow examples in ASH &mdash; Ash 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial: High-level CCSD(T)/CBS workflows" href="Highlevel_CC_CBS_workflows.html" />
    <link rel="prev" title="QM/MM on a protein" href="QM-MM-protein.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> Ash
          

          
            
            <img src="_static/ash-simple-logo-letterbig.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About.html">About ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-examples.html">Basic examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ash_program_philosophy.html">ASH Program Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate-input.html">Coordinates and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallelization.html">Parallelization in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-interfaces.html">QM Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="MM-interfaces.html">MM Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Jobtypes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="job-types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlepoint.html">Singlepoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_freq.html">Frequency calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_dynamics.html">Molecular dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="neb.html">Nudged Elastic Band Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="surfacescan.html">Surface Scans</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="module_QM-MM.html">QM/MM Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_benchmarking.html">Benchmarking in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_highlevel_workflows.html">Highlevel workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_molcrys.html">MOLCRYS: Automatic QM/MM for Molecular Crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_PES.html">PES: PhotoElectron/PhotoEmission Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_plotting.html">Plotting</a></li>
</ul>
<p class="caption"><span class="caption-text">Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ORCA-interface.html">ORCA interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="xTB-interface.html">xTB interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRCC-interface.html">MRCC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="CFour-interface.html">CFour interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="PySCF-interface.html">PySCF interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Psi4-interface.html">Psi4 interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="crest-interface.html">CREST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomeTRIC-interface.html">geomeTRIC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="knarr-interface.html">KNARR interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenMM-interface.html">OpenMM interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Explicit-solvation.html">Explicit solvation (small molecule)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-I.html">Metalloprotein tutorial I: Rubredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-II.html">Metalloprotein tutorial II: Ferredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-MM-protein.html">QM/MM on a protein</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflow examples in ASH</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-1-optimization-frequency-highlevel-singlepoint">Example 1 : Optimization + Frequency + HighLevel-singlepoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-2a-direct-calculation-of-reaction-energy-n2-3h2-2nh3">Example 2a : Direct calculation of Reaction Energy:  N<sub>2</sub>  + 3H<sub>2</sub> → 2NH<sub>3</sub></a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-2b-direct-calculation-of-reaction-energy-with-an-automatic-thermochemistry-protocol">Example 2b : Direct calculation of Reaction Energy with an Automatic Thermochemistry Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-3a-running-multiple-single-point-energies-with-different-functionals-sequential">Example 3a : Running multiple single-point energies with different functionals (sequential)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-3b-running-multiple-single-point-energies-with-different-functionals-in-parallel">Example 3b : Running multiple single-point energies with different functionals (in parallel)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-4a-running-single-point-energies-on-a-collection-of-xyz-files-sequential">Example 4a : Running single-point energies on a collection of XYZ files (sequential)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-4b-running-single-point-energies-on-a-collection-of-xyz-files-parallel">Example 4b : Running single-point energies on a collection of XYZ files (parallel)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-5-calculate-localized-orbitals-and-create-cube-files-for-multiple-xyz-files-or-an-xyz-trajectory">Example 5 : Calculate localized orbitals and create Cube files for multiple XYZ files or an XYZ-trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-6-running-conformer-sampling-geometry-optimizations-and-high-level-single-points">Example 6 : Running conformer-sampling, geometry optimizations and High-level single-points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Highlevel_CC_CBS_workflows.html">Tutorial: High-level CCSD(T)/CBS workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coordinate-tools.html">Coordinates and fragment tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ash</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Workflow examples in ASH</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/workflows-examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflow-examples-in-ash">
<h1>Workflow examples in ASH<a class="headerlink" href="#workflow-examples-in-ash" title="Permalink to this headline">¶</a></h1>
<p>As an ASH-script is pure Python and the user has access to various ASH functionality for reading in coordinates, create fragments,
call QM and MM codes, calculate energy, minimize geometry, run dynamics etc. this allows one to easily create advanced workflows in a single script.
ASH already contains a lot of pre-made workflow to automize things but the user can easily write their own ASH-Python scripts to automize
more complex workflows, not yet available directly in ASH.</p>
<p>This page goes through several examples of workflows showing both the use of pre-coded workflows and how you can write your own.</p>
<div class="section" id="example-1-optimization-frequency-highlevel-singlepoint">
<h2>Example 1 : Optimization + Frequency + HighLevel-singlepoint<a class="headerlink" href="#example-1-optimization-frequency-highlevel-singlepoint" title="Permalink to this headline">¶</a></h2>
<p>Running a geometry optimzation, frequency calculation (on optimized geometry) using e.g. a DFT protocol and then a single-point energy calculation
using a high-level theory (such as CCSD(T)) is a standard workflow in computational chemistry research, but is often performed manually as the QM-code is not always capable of performing all of the steps in a single job.
In ASH you can use the <strong>thermochemprotocol_single</strong> to automate such a workflow.</p>
<p>See: <a class="reference internal" href="module_workflows.html"><span class="doc">Workflows</span></a> for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">2</span>
<span class="c1">#Defining molecular fragment</span>
<span class="n">molstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">N 0 0 0</span>
<span class="s2">N 0 0 0.9</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">molstring</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Defining theories object for optimization+frequency and High-level CCSD(T)/CBS</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! r2SCAN-3c tightscf&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="n">HL</span> <span class="o">=</span> <span class="n">CC_CBS_Theory</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">cardinals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">basisfamily</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>


<span class="n">energy</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">thermochem</span> <span class="o">=</span> <span class="n">thermochemprotocol_single</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span> <span class="n">Opt_theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">SP_theory</span><span class="o">=</span><span class="n">HL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final HL energy:&quot;</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;Eh&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ZPVE: &quot;</span><span class="p">,</span> <span class="n">thermochem</span><span class="p">[</span><span class="s1">&#39;ZPVE&#39;</span><span class="p">],</span> <span class="s2">&quot;Eh&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>But you could of course also write this kind of simple workflow manually, allowing you possibly more flexibility that better suits your needs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">2</span>
<span class="c1">#Defining molecular fragment</span>
<span class="n">molstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">N 0 0 0</span>
<span class="s2">N 0 0 0.9</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">molstring</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#Defining ORCA object for optimization</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! r2SCAN-3c tightscf&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Geometry optimization of molecule and ORCAcalc theory object.</span>
<span class="n">geomeTRICOptimizer</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span><span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">)</span>

<span class="c1">#Numfreq job of molecule (contains optimized coordinates). A 2-point Hessian is requested in runmode serial.</span>
<span class="n">thermochem</span> <span class="o">=</span> <span class="n">NumFreq</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">npoint</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">runmode</span><span class="o">=</span><span class="s1">&#39;serial&#39;</span><span class="p">)</span>

<span class="c1">#Single-point HL job on optimized geometry</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">CC_CBS_Theory</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">cardinals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">basisfamily</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="n">HLenergy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">HL</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final HL energy: &quot;</span><span class="p">,</span> <span class="n">HLenergy</span><span class="p">,</span> <span class="s2">&quot;Eh&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ZPVE: &quot;</span><span class="p">,</span> <span class="n">thermochem</span><span class="p">[</span><span class="s1">&#39;ZPVE&#39;</span><span class="p">],</span> <span class="s2">&quot;Eh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2a-direct-calculation-of-reaction-energy-n2-3h2-2nh3">
<h2>Example 2a : Direct calculation of Reaction Energy:  N<sub>2</sub>  + 3H<sub>2</sub> → 2NH<sub>3</sub><a class="headerlink" href="#example-2a-direct-calculation-of-reaction-energy-n2-3h2-2nh3" title="Permalink to this headline">¶</a></h2>
<p>Typically one is interested in more than a single energy of a single species and thus you might want to run calculations on multiple species
of a reaction in the same job and calculate the reaction energy directly.
In ASH you can easily define multiple fragments in a script, group the fragments in a list and then loop over the fragments with a simple Python for-loop
that calculates the single-point energy for each fragment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#Defining all reaction species as ASH objects from XYZ-files</span>
<span class="n">N2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;n2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;h2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">NH3</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;nh3.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">##Defining reaction##</span>
<span class="c1"># List of species from reactant to product</span>
<span class="n">specieslist</span><span class="o">=</span><span class="p">[</span><span class="n">N2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">NH3</span><span class="p">]</span> <span class="c1">#Use same order as stoichiometry</span>

<span class="c1">#Defining ORCA theory object.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="n">FinalEnergies</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#Defining empty list to collect energies</span>
<span class="c1">#Python for-loop that loops over each molecule in list specieslist</span>
<span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">specieslist</span><span class="p">:</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">)</span>
    <span class="c1">#Adding energy to list. Note: Energy is also stored as part of fragment.</span>
    <span class="n">FinalEnergies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
    <span class="n">ORCAcalc</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final list of energies:&quot;</span><span class="p">,</span> <span class="n">FinalEnergies</span><span class="p">)</span>
<span class="n">reaction_energy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">FinalEnergies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">FinalEnergies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">FinalEnergies</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="mf">627.509</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reaction energy:&quot;</span><span class="p">,</span> <span class="n">reaction_energy</span><span class="p">,</span> <span class="s2">&quot;kcal/mol&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The script above is verbose but the structure gives you a lot of flexibility that you can adapt to your needs.
Of course, ASH already contains functions to carry out such a job in a simpler way: <strong>Singlepoint_fragments</strong> and <strong>ReactionEnergy</strong>.
See <a class="reference internal" href="singlepoint.html"><span class="doc">Singlepoint</span></a> and <a class="reference internal" href="module_workflows.html"><span class="doc">Workflows</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#Haber-Bosch reaction: N2 + 3H2 =&gt; 2NH3</span>
<span class="n">N2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">diatomic</span><span class="o">=</span><span class="s2">&quot;N2&quot;</span><span class="p">,</span> <span class="n">diatomic_bondlength</span><span class="o">=</span><span class="mf">1.0975</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#Diatomic molecules can be defined like this also</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">diatomic</span><span class="o">=</span><span class="s2">&quot;H2&quot;</span><span class="p">,</span> <span class="n">diatomic_bondlength</span><span class="o">=</span><span class="mf">0.74</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#Diatomic molecules can be defined like this also</span>
<span class="n">NH3</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;nh3.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">specieslist</span><span class="o">=</span><span class="p">[</span><span class="n">N2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">NH3</span><span class="p">]</span> <span class="c1">#An ordered list of ASH fragments.</span>
<span class="n">stoichiometry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#Using same order as specieslist.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">Singlepoint_fragments</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragments</span><span class="o">=</span><span class="n">specieslist</span><span class="p">)</span> <span class="c1">#Calculating list of energies</span>

<span class="c1">#Calculating reaction-energy using list and stoichiometry</span>
<span class="n">reaction_energy</span><span class="p">,</span> <span class="n">unused</span> <span class="o">=</span> <span class="n">ReactionEnergy</span><span class="p">(</span><span class="n">stoichiometry</span><span class="o">=</span><span class="n">stoichiometry</span><span class="p">,</span> <span class="n">list_of_energies</span><span class="o">=</span><span class="n">energies</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;kcal/mol&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ΔE&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Reaction_energy: -37.157156917851935 kcal/permol
</pre></div>
</div>
</div>
<div class="section" id="example-2b-direct-calculation-of-reaction-energy-with-an-automatic-thermochemistry-protocol">
<h2>Example 2b : Direct calculation of Reaction Energy with an Automatic Thermochemistry Protocol<a class="headerlink" href="#example-2b-direct-calculation-of-reaction-energy-with-an-automatic-thermochemistry-protocol" title="Permalink to this headline">¶</a></h2>
<p>You can also combine the Opt+Freq+HL protocol from Example 1 with the multiple fragments-at-the-same-time approach from Example 2
and calculate the reaction energy directly at a high-level of theory together with thermochemical corrections from a frequency job.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>

<span class="n">N2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;n2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;h2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">NH3</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;nh3.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">##Defining reaction</span>
<span class="n">specieslist</span><span class="o">=</span><span class="p">[</span><span class="n">N2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">NH3</span><span class="p">]</span> <span class="c1">#Use same order as stoichiometry</span>
<span class="n">stoichiometry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#Use same order as specieslist</span>

<span class="c1">#Define theories</span>
<span class="n">OptFreqtheory</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="n">HL</span><span class="o">=</span><span class="n">CC_CBS_Theory</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span><span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">basisfamily</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="n">cardinals</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="c1">#Thermochemistry protocol</span>
<span class="n">thermochemprotocol_reaction</span><span class="p">(</span><span class="n">fraglist</span><span class="o">=</span><span class="n">specieslist</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="o">=</span><span class="n">stoichiometry</span><span class="p">,</span> <span class="n">Opt_theory</span><span class="o">=</span><span class="n">OptFreqtheory</span><span class="p">,</span> <span class="n">SP_theory</span><span class="o">=</span><span class="n">HL</span><span class="p">,</span>
            <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">analyticHessian</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">pressure</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Final output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> Reaction_energy(ΔSCF):  -33.980155385058865
 Reaction_energy(ΔCCSD):  -6.937247193220541
 Reaction_energy(Δ(T)):  1.4333499904116154
 Reaction_energy(ΔCV+SR):  -0.07653672690344188
 Reaction_energy(ΔSO):  0.0
 Reaction_energy(ΔZPVE):  20.455727327700334
----------------------------------------------
 Reaction_energy(Total ΔE):  -19.104861987083417
</pre></div>
</div>
<p>The output shows the total reaction energy (0 K enthalpy) and the contribution from Hartree-Fock (SCF), singles-doubles excitations (ΔCCSD),
perturbative triples (Δ(T)), core-valence + scalar-relativistics (CV+SR), atomic spin-orbit coupling (ΔSO, here none), and zero-point
vibrational energy (ΔZPVE).
The agreement with experiment (-18.4 kcal/mol) is excellent.</p>
</div>
<div class="section" id="example-3a-running-multiple-single-point-energies-with-different-functionals-sequential">
<h2>Example 3a : Running multiple single-point energies with different functionals (sequential)<a class="headerlink" href="#example-3a-running-multiple-single-point-energies-with-different-functionals-sequential" title="Permalink to this headline">¶</a></h2>
<p>You might be interested in running multiple single-point energy calculations on a molecule with different functionals.
Such a job could be written directly like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>
<span class="n">h2string</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">H 0 0 0</span>
<span class="s2">H 0 0 0.7</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">h2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">h2string</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#List of functional keywords (strings) to loop over. Need to be valid ORCA keywords.</span>
<span class="n">functionals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BP86&#39;</span><span class="p">,</span> <span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSS&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSSh&#39;</span><span class="p">,</span> <span class="s1">&#39;PBE0&#39;</span><span class="p">,</span> <span class="s1">&#39;BHLYP&#39;</span><span class="p">,</span> <span class="s1">&#39;CAM-B3LYP&#39;</span><span class="p">]</span>

<span class="c1">#Dictionary to keep track of energies</span>
<span class="n">energies_dict</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">functional</span> <span class="ow">in</span> <span class="n">functionals</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FUNCTIONAL: &quot;</span><span class="p">,</span> <span class="n">functional</span><span class="p">)</span>
    <span class="c1">#Defining/redefining ORCA theory.</span>
    <span class="c1">#Appending functional keyword to the string-variable that contains the ORCA inputline</span>
    <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! def2-SVP tightscf slowconv &quot;</span> <span class="o">+</span> <span class="n">functional</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcadir</span><span class="o">=</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="c1"># Run single-point job</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">h2</span><span class="p">)</span>
    <span class="c1">#Keep ORCA outputfile for each functional</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;orca-input.out&#39;</span><span class="p">,</span> <span class="n">functional</span><span class="o">+</span><span class="s1">&#39;_orcajob.out&#39;</span><span class="p">)</span>
    <span class="c1">#Adding energy to dictionary</span>
    <span class="n">energies_dict</span><span class="p">[</span><span class="n">functional</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span>
    <span class="c1">#Cleaning up after each job (not always necessary)</span>
    <span class="n">ORCAcalc</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dictionary with results:&quot;</span><span class="p">,</span> <span class="n">energies_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1">#Pretty formatted printing:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Functional   Energy (Eh)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">energies_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:10}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
<p>Producing a nice table of results:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> Functional   Energy (Eh)
----------------------------
BP86       -1.1689426849
B3LYP      -1.1642632249
TPSS       -1.1734355861
TPSSh      -1.1729787552
PBE0       -1.1610065506
BHLYP      -1.1624650247
CAM-B3LYP  -1.1625896338
</pre></div>
</div>
<p>But could also be written a bit more succinctly using the <strong>Singlepoint_theories</strong> function, see <a class="reference internal" href="singlepoint.html"><span class="doc">Singlepoint</span></a> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>
<span class="c1">#Readomg h2.xyz from internal database</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">databasefile</span><span class="o">=</span><span class="s2">&quot;h2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#List of functional keywords (strings) to loop over. Need to be valid ORCA keywords.</span>
<span class="n">functionals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BP86&#39;</span><span class="p">,</span> <span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSS&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSSh&#39;</span><span class="p">,</span> <span class="s1">&#39;PBE0&#39;</span><span class="p">,</span> <span class="s1">&#39;BHLYP&#39;</span><span class="p">,</span> <span class="s1">&#39;CAM-B3LYP&#39;</span><span class="p">]</span>
<span class="n">theories</span><span class="o">=</span><span class="p">[]</span>
<span class="c1">#Looping over strings to create a list of theories</span>
<span class="k">for</span> <span class="n">functional</span> <span class="ow">in</span> <span class="n">functionals</span><span class="p">:</span>
    <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! def2-SVP tightscf slowconv &quot;</span> <span class="o">+</span> <span class="n">functional</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcadir</span><span class="o">=</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="n">theories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ORCAcalc</span><span class="p">)</span>
<span class="c1">#Use Singlepoint_theories to run a SP calculation on fragment with each theory</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">Singlepoint_theories</span><span class="p">(</span><span class="n">theories</span><span class="o">=</span><span class="n">theories</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">H2</span><span class="p">)</span>
</pre></div>
</div>
<p>with a final table being printed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>======================================================================
Singlepoint_theories: Table of energies of each theory:
======================================================================

Theory class    Theory Label     Charge    Mult           Energy(Eh)
----------------------------------------------------------------------
ORCATheory      BP86                  0       1        -1.1716903176
ORCATheory      B3LYP                 0       1        -1.1668726382
ORCATheory      TPSS                  0       1        -1.1756974430
ORCATheory      TPSSh                 0       1        -1.1753091518
ORCATheory      PBE0                  0       1        -1.1636152299
ORCATheory      BHLYP                 0       1        -1.1646744530
ORCATheory      CAM-B3LYP             0       1        -1.1653189937
</pre></div>
</div>
</div>
<div class="section" id="example-3b-running-multiple-single-point-energies-with-different-functionals-in-parallel">
<h2>Example 3b : Running multiple single-point energies with different functionals (in parallel)<a class="headerlink" href="#example-3b-running-multiple-single-point-energies-with-different-functionals-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>The examples in 3a ran each job sequentially, one after the other, according to the list of functional strings defined.
While ORCA parallelization was utilized, it may be more economical to run the jobs simultaneously instead, especially if there are lot of jobs to go through.
This can be accomplished using the <strong>Singlepoint_parallel</strong> function inside ASH.
Here Python multiprocessing (pool.apply_async) is utilized. In this case ORCA parallelization is by default turned off, though it can be enabled if done carefully.
See <a class="reference internal" href="parallelization.html"><span class="doc">Parallelization in ASH</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>
<span class="c1">#Fragment</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;h2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Single-point job parallelization</span>
<span class="c1">#Case: Multiple theories</span>
<span class="c1">#Creating multiple ORCA objects and storing in list: orcaobjects</span>
<span class="c1">#Important: use a label (here functional-name)for the created ORCA object to distinguish jobs</span>
<span class="n">orcaobjects</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">functional</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BP86&#39;</span><span class="p">,</span> <span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSS&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSSh&#39;</span><span class="p">,</span> <span class="s1">&#39;PBE0&#39;</span><span class="p">,</span> <span class="s1">&#39;BHLYP&#39;</span><span class="p">,</span> <span class="s1">&#39;CAM-B3LYP&#39;</span><span class="p">]:</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcadir</span><span class="o">=</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! def2-SVP def2/J &quot;</span><span class="o">+</span><span class="n">functional</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">functional</span><span class="p">)</span>
    <span class="n">orcaobjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ORCAcalc</span><span class="p">)</span>

<span class="c1">#Calling the Singlepoint_parallel function and providing list of fragments and list of theories:</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">Singlepoint_parallel</span><span class="p">(</span><span class="n">fragments</span><span class="o">=</span><span class="p">[</span><span class="n">H2</span><span class="p">],</span> <span class="n">theories</span><span class="o">=</span><span class="n">orcaobjects</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#results is a dictionary of energies</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;results :&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-4a-running-single-point-energies-on-a-collection-of-xyz-files-sequential">
<h2>Example 4a : Running single-point energies on a collection of XYZ files (sequential)<a class="headerlink" href="#example-4a-running-single-point-energies-on-a-collection-of-xyz-files-sequential" title="Permalink to this headline">¶</a></h2>
<p>At other times you are interested in using a single theory to run single-point energies on a collection of molecules.
This could again be accomplished using a straightforward for-loop where we first define the path to the XYZ-file directory, change directory to it (os.chdir),
and then use glob to find all files with an “.xyz” file suffix.
Next, loop over those XYZ-files, define a fragment from each XYZ-file and then run a single-point calculation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#Directory of XYZ files. Can be full path or relative path.</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;/path/to/xyz_files&#39;</span>
<span class="c1">#Changing to dir</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>

<span class="n">energies</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.xyz&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;XYZ-file:&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#Note: Here we have to assume that charge=0 and mult=1 for every molecule</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">mol</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Energy of file </span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> Eh&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">energy</span><span class="p">))</span>
    <span class="n">ORCAcalc</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1">#Pretty print</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; XYZ-file             Energy (Eh)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
<span class="k">for</span> <span class="n">xyzfile</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.xyz&#39;</span><span class="p">),</span><span class="n">energies</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:20}</span><span class="s2"> </span><span class="si">{:&gt;13.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xyzfile</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> XYZ-file             Energy (Eh)
-------------------------------------------------
h2.xyz               -1.1715257797
h2o_MeOH.xyz         -192.0023991603
O-O-dimer.xyz        -149.8555328055
butane.xyz           -158.3248873844
nh3.xyz              -56.5093301286
n2.xyz               -109.4002969311
hi.xyz               -298.3735362292
h2o_strained.xyz     -76.2253312246
</pre></div>
</div>
<p>Again, we can simplify the script with the help of built-in ASH functionality: <strong>read_xyzfiles</strong> and <strong>Singlepoint_fragments</strong>
See: <a class="reference internal" href="coordinate-input.html"><span class="doc">Coordinates and fragments</span></a> and <a class="reference internal" href="singlepoint.html"><span class="doc">Singlepoint</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#Directory of XYZ files. Can be full path or relative path.</span>
<span class="n">xyzdir</span> <span class="o">=</span> <span class="s1">&#39;/path/to/xyz_files&#39;</span>

<span class="c1">#This function reads in all XYZ-files from the chosen directory and returns a list of ASH fragments</span>
<span class="c1">#Note: Each XYZ-file must have charge/mult defined in 2nd line of header for readchargemult=True to work</span>
<span class="n">fragments</span> <span class="o">=</span> <span class="n">read_xyzfiles</span><span class="p">(</span><span class="n">xyzdir</span><span class="p">,</span> <span class="n">readchargemult</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_from_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#Define theory</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Call Singlepoint_fragments and get list of calculated energies at chosen theory</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">Singlepoint_fragments</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragments</span><span class="o">=</span><span class="n">fragments</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>======================================================================
Singlepoint_fragments: Table of energies of each fragment:
======================================================================
Formula    Label                 Charge    Mult           Energy(Eh)
----------------------------------------------------------------------
H1I1       hi.xyz                     0       1      -298.3737182333
N1H3       nh3.xyz                    0       1       -56.5093324450
H2         h2.xyz                     0       1        -1.1715262206
H2O1       h2o_strained.xyz           0       1       -76.2253299452
C4H10      butane.xyz                 0       1      -158.3249141864
O2         O-O-dimer.xyz              0       1      -149.8555433766
N2         n2.xyz                     0       1      -109.4002889693
H6O2C1     h2o_MeOH.xyz               0       1      -192.0023967568
</pre></div>
</div>
<p>Such a protocol can be further simplified using the <strong>calc_xyzfiles</strong> function that even allows you to even run a thermochemistry workflow on each XYZ-file.
See: <a class="reference internal" href="module_workflows.html"><span class="doc">Workflows</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#Directory of XYZ files. Can be full path or relative path.</span>
<span class="n">xyzdir</span> <span class="o">=</span> <span class="s1">&#39;/path/to/xyz_files&#39;</span>

<span class="c1">#Define theory</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Call calc_xyzfiles giving xyzdir and theory.</span>
<span class="c1">#Geometry optimizations for each XYZ-file can be requested via Opt=True (default False, i.e. singlepoint)</span>
<span class="n">calc_xyzfiles</span><span class="p">(</span><span class="n">xyzdir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-4b-running-single-point-energies-on-a-collection-of-xyz-files-parallel">
<h2>Example 4b : Running single-point energies on a collection of XYZ files (parallel)<a class="headerlink" href="#example-4b-running-single-point-energies-on-a-collection-of-xyz-files-parallel" title="Permalink to this headline">¶</a></h2>
<p>The examples in 4a had each job run sequentially, one job after the other, according to the list of XYZ-files available.
While ORCA parallelization was utilized, it may be more economical to run such embarrassingly parallel jobs simultaneously instead, especially if there are lot of XYZ-files.
This can be accomplished using the Singlepoint_parallel function inside ASH. This utilizes Python multiprocessing (pool.apply_async).
ORCA parallelization is here turned off.</p>
<p>See <a class="reference internal" href="parallelization.html"><span class="doc">Parallelization in ASH</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcadir</span><span class="o">=</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#Directory of XYZ files. Can be full path or relative path.</span>
<span class="n">xyzdir</span> <span class="o">=</span> <span class="s1">&#39;./xyz_files&#39;</span>

<span class="n">molecules</span> <span class="o">=</span> <span class="n">read_xyzfiles</span><span class="p">(</span><span class="n">xyzdir</span><span class="p">,</span><span class="n">readchargemult</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_from_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Calling the Singlepoint_parallel function and providing list of fragments and list of theories:</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">Singlepoint_parallel</span><span class="p">(</span><span class="n">fragments</span><span class="o">=</span><span class="n">molecules</span><span class="p">,</span> <span class="n">theories</span><span class="o">=</span><span class="p">[</span><span class="n">ORCAcalc</span><span class="p">],</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#results is a dictionary of energies</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;results :&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-5-calculate-localized-orbitals-and-create-cube-files-for-multiple-xyz-files-or-an-xyz-trajectory">
<h2>Example 5 : Calculate localized orbitals and create Cube files for multiple XYZ files or an XYZ-trajectory<a class="headerlink" href="#example-5-calculate-localized-orbitals-and-create-cube-files-for-multiple-xyz-files-or-an-xyz-trajectory" title="Permalink to this headline">¶</a></h2>
<p>Analyzing electronic structure along a reaction path (e.g. a NEB or IRC path) or a trajectory (optimization or MD)
can be useful to understand the nature of the reaction. The code below shows how this can be accomplished in ASH
via a workflow involving single-point DFT, orbital localization and Cube-file creation (via orca_plot).</p>
<p>See <a class="reference internal" href="ORCA-interface.html"><span class="doc">ORCA interface</span></a> for information on <strong>run_orca_plot</strong>.</p>
<p>Using a collection of XYZ-files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="c1">#</span>
<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#Directory of XYZ files. Can be full path or relative path.</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;/home/bjornsson/ASH-DEV_GIT/testsuite/localized-orbital-IRC-workflow/calcs/images&#39;</span>

<span class="c1">#Localization block in ORCA inputfile</span>
<span class="n">blockinput</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%lo</span><span class="s2">c</span>
<span class="s2">LocMet IAOIBO</span>
<span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Looping over XYZ-files in directory, creating ASH fragments, running ORCA and calling orca_plot</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;/*.xyz&#39;</span><span class="p">)):</span>
    <span class="n">basefile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;XYZ-file:&quot;</span><span class="p">,</span> <span class="n">basefile</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blockinput</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">mol</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Energy of file </span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> Eh&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basefile</span><span class="p">,</span> <span class="n">energy</span><span class="p">))</span>
    <span class="n">locfile</span><span class="o">=</span><span class="n">basefile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_calc.loc&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;orca-input.loc&#39;</span><span class="p">,</span> <span class="n">locfile</span><span class="p">)</span>
    <span class="c1">#Call ORCA_plot and create Cube file for specific MO in locfile: here alpha-MOs 13 and 17</span>
    <span class="n">run_orca_plot</span><span class="p">(</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">locfile</span><span class="p">,</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">gridvalue</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mo_operator</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mo_number</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">run_orca_plot</span><span class="p">(</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">locfile</span><span class="p">,</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">gridvalue</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mo_operator</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mo_number</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="n">ORCAcalc</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using a multi-XYZ file containing multiple sets of geometries (could be a NEB path, MD/Opt trajectory, XYZ animation etc.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#</span>
<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#Name of trajectory file containing multiple geometries (could be optimization traj, MD traj, NEB-path traj, Hessian XYZ animation etc.)</span>
<span class="c1">#File should be in dir</span>
<span class="n">trajectoryfile</span><span class="o">=</span><span class="s2">&quot;neb-ts_MEP_trj.xyz&quot;</span>

<span class="n">blockinput</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%lo</span><span class="s2">c</span>
<span class="s2">LocMet IAOIBO</span>
<span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">fraglist</span> <span class="o">=</span> <span class="n">get_molecules_from_trajectory</span><span class="p">(</span><span class="n">trajectoryfile</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">frag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fraglist</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frag :&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP def2/J&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blockinput</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Energy of frag </span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> Eh&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">energy</span><span class="p">))</span>
    <span class="n">locfile</span><span class="o">=</span><span class="s1">&#39;frag</span><span class="si">{}</span><span class="s1">_calc.loc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;orca-input.loc&#39;</span><span class="p">,</span> <span class="n">locfile</span><span class="p">)</span>
    <span class="c1">#Call ORCA_plot and create Cube file for specific MO in locfile: here alpha-MOs 13 and 17</span>
    <span class="n">run_orca_plot</span><span class="p">(</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">locfile</span><span class="p">,</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">gridvalue</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mo_operator</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mo_number</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">run_orca_plot</span><span class="p">(</span><span class="n">orcadir</span><span class="p">,</span> <span class="n">locfile</span><span class="p">,</span> <span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">gridvalue</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mo_operator</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mo_number</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="n">ORCAcalc</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="example-6-running-conformer-sampling-geometry-optimizations-and-high-level-single-points">
<h2>Example 6 : Running conformer-sampling, geometry optimizations and High-level single-points<a class="headerlink" href="#example-6-running-conformer-sampling-geometry-optimizations-and-high-level-single-points" title="Permalink to this headline">¶</a></h2>
<p>This example utilizes the interface to the powerful <a class="reference external" href="https://xtb-docs.readthedocs.io/en/latest/crest.html">crest</a> program to perform metadynamics-based conformational sampling from a starting geometry at a semi-empirical level of theory (GFN2-xTB).
From the conformational sampling we get a collection of low-energy conformers for that molecule (based on the GFN1-xTB or GFN2-xTB semi-empirical tightbinding Hamiltonian)
The conformational sampling is then followed by a DFT geometry optimization for each conformer.
Finally high-level coupled cluster single-point calculations (here DLPNO-CCSD(T)/CBS extrapolations) are performed for each conformer.</p>
<p>Such an example can be written in ASH like this in a rather verbose manner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>

<span class="c1">#0. Starting structure and charge and mult</span>
<span class="n">charge</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mult</span><span class="o">=</span><span class="mi">1</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;ethanol.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="n">mult</span><span class="p">)</span>

<span class="c1">#1. Calling crest</span>
<span class="n">call_crest</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN2-xTB&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#2. Grab low-lying conformers from crest_conformers.xyz as list of ASH fragments.</span>
<span class="n">list_conformer_frags</span><span class="p">,</span> <span class="n">xtb_energies</span> <span class="o">=</span> <span class="n">get_crest_conformers</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list_conformer_frags:&quot;</span><span class="p">,</span> <span class="n">list_conformer_frags</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Crest Conformer Searches done. Found </span><span class="si">{}</span><span class="s2"> conformers&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xtb_energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xTB energies: &quot;</span><span class="p">,</span> <span class="n">xtb_energies</span><span class="p">)</span>

<span class="c1">#3. Run DFT geometry optimizations for each crest-conformer</span>
<span class="c1">#ML Theory level. TODO: Run in ASH parallel instead of ORCA parallel?</span>
<span class="n">MLorcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 D3 def2-TZVP def2/J Grid5 Finalgrid6 tightscf&quot;</span>
<span class="n">MLorcablocks</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">cf maxiter 200 end&quot;</span>
<span class="n">MLORCATheory</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="n">MLorcasimpleinput</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">MLorcablocks</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="n">DFT_energies</span><span class="o">=</span><span class="p">[]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">conformer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_conformer_frags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing DFT Geometry Optimization for Conformer &quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">geomeTRICOptimizer</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">conformer</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">MLORCATheory</span><span class="p">,</span> <span class="n">coordsystem</span><span class="o">=</span><span class="s1">&#39;tric&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="n">mult</span><span class="p">)</span>
    <span class="n">DFT_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conformer</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
    <span class="c1">#Saving ASH fragment and XYZ file for each DFT-optimized conformer</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Fragment-optimized.ygg&#39;</span><span class="p">,</span> <span class="s1">&#39;Conformer</span><span class="si">{}</span><span class="s1">_DFT.ygg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Fragment-optimized.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;Conformer</span><span class="si">{}</span><span class="s1">_DFT.xyz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DFT Geometry Optimization done&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DFT_energies: &quot;</span><span class="p">,</span> <span class="n">DFT_energies</span><span class="p">)</span>

<span class="c1">#4.Run high-level DLPNO-CCSD(T). Ash should now have optimized conformers</span>
<span class="n">HL_CC</span> <span class="o">=</span> <span class="n">CC_CBS_Theory</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">molecule</span><span class="o">.</span><span class="n">elems</span><span class="p">,</span> <span class="n">cardinals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">basisfamily</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="n">DLPNO</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="n">HL_energies</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">conformer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_conformer_frags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing High-level calculation for DFT-optimized Conformer &quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">HLenergy</span> <span class="o">=</span> <span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">HL_CC</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">conformer</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="n">mult</span><span class="p">)</span>
    <span class="n">HL_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HLenergy</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FINAL RESULTS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================&quot;</span><span class="p">)</span>

<span class="c1">#Printing total energies</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Conformer   xTB-energy    DFT-energy    HL-energy (Eh)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------------------------------------&quot;</span><span class="p">)</span>

<span class="n">min_xtbenergy</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">xtb_energies</span><span class="p">)</span>
<span class="n">min_dftenergy</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">DFT_energies</span><span class="p">)</span>
<span class="n">min_HLenergy</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">HL_energies</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,(</span><span class="n">xtb_en</span><span class="p">,</span><span class="n">dft_en</span><span class="p">,</span><span class="n">HL_en</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xtb_energies</span><span class="p">,</span><span class="n">DFT_energies</span><span class="p">,</span> <span class="n">HL_energies</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:10}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">xtb_en</span><span class="p">,</span> <span class="n">dft_en</span><span class="p">,</span> <span class="n">HL_en</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1">#Printing relative energies</span>
<span class="n">min_xtbenergy</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">xtb_energies</span><span class="p">)</span>
<span class="n">min_dftenergy</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">DFT_energies</span><span class="p">)</span>
<span class="n">min_HLenergy</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">HL_energies</span><span class="p">)</span>
<span class="n">harkcal</span> <span class="o">=</span> <span class="mf">627.50946900</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Conformer   xTB-energy    DFT-energy    HL-energy (kcal/mol)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------------------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,(</span><span class="n">xtb_en</span><span class="p">,</span><span class="n">dft_en</span><span class="p">,</span><span class="n">HL_en</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xtb_energies</span><span class="p">,</span><span class="n">DFT_energies</span><span class="p">,</span> <span class="n">HL_energies</span><span class="p">)):</span>
    <span class="n">rel_xtb</span><span class="o">=</span><span class="p">(</span><span class="n">xtb_en</span><span class="o">-</span><span class="n">min_xtbenergy</span><span class="p">)</span><span class="o">*</span><span class="n">harkcal</span>
    <span class="n">rel_dfT</span><span class="o">=</span><span class="p">(</span><span class="n">dft_en</span><span class="o">-</span><span class="n">min_dftenergy</span><span class="p">)</span><span class="o">*</span><span class="n">harkcal</span>
    <span class="n">rel_HL</span><span class="o">=</span><span class="p">(</span><span class="n">HL_en</span><span class="o">-</span><span class="n">min_HLenergy</span><span class="p">)</span><span class="o">*</span><span class="n">harkcal</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:10}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2"> </span><span class="si">{:13.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">rel_xtb</span><span class="p">,</span> <span class="n">rel_dfT</span><span class="p">,</span> <span class="n">rel_HL</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workflow done!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The manually defined workflow above is a bit verbose and can of course also be more conveniently run like below where we use the
<strong>confsampler_protocol</strong> function (see <a class="reference internal" href="crest-interface.html"><span class="doc">CREST interface</span></a>), that takes as input the ASH fragment and 2 levels of ASH theories to be used for geometry optimizations and high-level singlepoint energies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>
<span class="c1">#Fragment to define. Here taken from internal database</span>
<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">databasefile</span><span class="o">=</span><span class="s2">&quot;ethanol.xyz&quot;</span><span class="p">)</span>

<span class="c1">#Defining MLTheory: DFT optimization</span>
<span class="n">MLsimpleinput</span><span class="o">=</span><span class="s2">&quot;! B3LYP D4 def2-TZVP TightSCF&quot;</span>
<span class="n">MLblockinput</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%s</span><span class="s2">cf maxiter 200 end</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">ML_B3LYP</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="n">MLsimpleinput</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">MLblockinput</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="c1">#Defining HLTheory: DLPNO-CCSD(T)/CBS</span>
<span class="n">HL_CC</span> <span class="o">=</span> <span class="n">CC_CBS_Theory</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">molecule</span><span class="o">.</span><span class="n">elems</span><span class="p">,</span> <span class="n">cardinals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">basisfamily</span><span class="o">=</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="n">DLPNO</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
<span class="c1">#Call confsampler_protocol</span>
<span class="n">confsampler_protocol</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN2-xTB&#39;</span><span class="p">,</span> <span class="n">MLtheory</span><span class="o">=</span><span class="n">ML_B3LYP</span><span class="p">,</span>
                        <span class="n">HLtheory</span><span class="o">=</span><span class="n">HL_CC</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
</pre></div>
</div>
<p>Final result table of total and relative energies of calculated conformers at 3 different theory levels:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>=================
FINAL RESULTS
=================

 Conformer   xTB-energy    DFT-energy    HL-energy (Eh)
----------------------------------------------------------------
         0 -25.8392205500 -346.2939482921 -345.2965932205
         1 -25.8377914500 -346.2884905132 -345.2911748671
         2 -25.8358803400 -346.2818766960 -345.2848279253
         3 -25.8313250600 -346.2788608396 -345.2815202116
         4 -25.8307377800 -346.2788662649 -345.2815419285
         5 -25.8303374700 -346.2775476223 -345.2792917601
         6 -25.8300128900 -346.2776089771 -345.2794648759

 Conformer   xTB-energy    DFT-energy    HL-energy (kcal/mol)
----------------------------------------------------------------
         0  0.0000000000  0.0000000000  0.0000000000
         1  0.8967737821  3.4248079602  3.4000680178
         2  2.0960134034  7.5750408530  7.3828340833
         3  4.9544947374  9.4675192805  9.4584557521
         4  5.3230184983  9.4641148891  9.4448282319
         5  5.5742168139 10.2915756050 10.8568301896
         6  5.7778938373 10.2530749008 10.7481984235
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Highlevel_CC_CBS_workflows.html" class="btn btn-neutral float-right" title="Tutorial: High-level CCSD(T)/CBS workflows" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="QM-MM-protein.html" class="btn btn-neutral float-left" title="QM/MM on a protein" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Ragnar Bjornsson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>