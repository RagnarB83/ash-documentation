

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>OpenMM interface &mdash; Ash 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="QM/MM on a protein" href="QM-MM-protein.html" />
    <link rel="prev" title="knarr interface" href="knarr-interface.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> Ash
          

          
            
            <img src="_static/ash-simple-logo-letterbig.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About.html">About ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate-input.html">Coordinates and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="job-types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-interfaces.html">QM Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="MM-interfaces.html">MM Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Internal modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="module_QM-MM.html">QM/MM Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_benchmarking.html">Benchmarking in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_coords.html">Coords module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_dynamics.html">Dynamics module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_freq.html">Freq module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_workflows.html">Workflows module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_highlevel_workflows.html">Highlevel workflows module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_molcrys.html">MOLCRYS: Automatic QM/MM for Molecular Crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_PES.html">PES: PhotoElectron/PhotoEmission Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_plotting.html">Plotting</a></li>
</ul>
<p class="caption"><span class="caption-text">Interfaces</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ORCA-interface.html">ORCA interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="xTB-interface.html">xTB interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRCC-interface.html">MRCC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="CFour-interface.html">CFour interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="PySCF-interface.html">PySCF interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Psi4-interface.html">Psi4 interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="crest-interface.html">CREST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomeTRIC-interface.html">geomeTRIC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="knarr-interface.html">knarr interface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">OpenMM interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-openmmtheory-theory-level">The OpenMMTheory theory level</a></li>
<li class="toctree-l2"><a class="reference internal" href="#molecular-dynamics-via-openmm">Molecular Dynamics via OpenMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-minimization-via-openmm">Simple minimization via OpenMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-setup-via-openmm-modeller">System setup via OpenMM: Modeller</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="QM-MM-protein.html">QM/MM on a protein</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows-examples.html">Workflow examples in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermochemistry.html">High-level Thermochemistry in ASH</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coordinate-tools.html">Coordinates and fragment tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ash</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>OpenMM interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/OpenMM-interface.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="openmm-interface">
<h1>OpenMM interface<a class="headerlink" href="#openmm-interface" title="Permalink to this headline">¶</a></h1>
<p>OpenMM is an open-source molecular mechanics library written in C++. It comes with a handy Python interface that was easily adapted for use with ASH. It has been designed for both CPU and GPU codes.</p>
<div class="section" id="the-openmmtheory-theory-level">
<h2>The OpenMMTheory theory level<a class="headerlink" href="#the-openmmtheory-theory-level" title="Permalink to this headline">¶</a></h2>
<p>OpenMM can run either on the CPU or on the GPU platform by specifying platform as either: ‘CPU’, ‘OpenCL’ or ‘CUDA’ depending on whether there is a GPU available on the computer. For platform=’CPU’ the numcores can additionally be specified in order to control the number of CPU cores. Alternatively the shell environment variable OPENMM_CPU_THREADS can be set to control the number of CPU cores that OpenMM will use. If neither numcores keyword is provided or OPENMM_CPU_THREADS variable set, OpenMM will use the number of physical cores present.</p>
<p>The OpenMMTheory class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OpenMMTheory</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printlevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;CPU&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">CHARMMfiles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">psffile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charmmtopfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charmmprmfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">GROMACSfiles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gromacstopfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gromacstopdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Amberfiles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">amberprmtopfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xmlfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pdbfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_parmed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">do_energy_decomposition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">periodic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">charmm_periodic_cell_dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">customnonbondedforce</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">periodic_nonbonded_cutoff</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">dispersion_correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">switching_function_distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">ewalderrortolerance</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">PMEparameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">delete_QM1_MM1_bonded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">applyconstraints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">autoconstraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hydrogenmass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rigidwater</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</pre></div>
</div>
<p>It is possible to read in multiple types of forcefield files: AmberFiles, CHARMMFiles, GROMACSFiles or an OpenMM XML forcefieldfile.
Note: In rare cases OpenMM fails to read in Amber/CHARMM/GROMACS files correctly. In those cases the Parmed library may be more successful (use_parmed=True). Requires ParMed (pip install parmed).</p>
<p>Example creation of an OpenMMtheory object with CHARMM-files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">forcefielddir</span><span class="o">=</span><span class="s2">&quot;/path/to/dir&quot;</span>
<span class="n">topfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;top_all36_prot.rtf&quot;</span>
<span class="n">parfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;par_all36_prot.prm&quot;</span>
<span class="n">psffile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;new-XPLOR-psffile.psf&quot;</span>
<span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">CHARMMfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span> <span class="n">charmmtopfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span>
                           <span class="n">charmmprmfile</span><span class="o">=</span><span class="n">parfile</span><span class="p">)</span>
</pre></div>
</div>
<p>Example creation of an OpenMMtheory object with GROMACS-files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">GROMACSfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gromacstopdir</span><span class="o">=</span><span class="s2">&quot;/path/to/gromacstopdir&quot;</span><span class="p">,</span>
                <span class="n">gromacstopfile</span><span class="o">=</span><span class="s2">&quot;gromacstopfile.top&quot;</span><span class="p">,</span> <span class="n">grofile</span><span class="o">=</span><span class="s2">&quot;grofile.gro&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example creation of an OpenMMtheory object with AMBER files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">Amberfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">amberprmtopfile</span><span class="o">=</span><span class="s2">&quot;/path/to/amberprmtopfile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example creation of an OpenMMtheory object with OpenMM XML file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">xmlfile</span><span class="o">=</span><span class="s2">&quot;example.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>An openmmtheory object can then be used to create a QM/MM theory object. See <a class="reference internal" href="module_QM-MM.html"><span class="doc">QM/MM Theory</span></a> page.</p>
<p>Periodic boundary conditions:</p>
<ul class="simple">
<li><p>If periodic boundary conditions are chosen (periodic=True) then the PBC box parameters are automatically found in the Amber PRMTOP file or the GROMACS Grofile or in the case of CHARMM-files they need to be provided: charmm_periodic_cell_dimensions</p></li>
<li><p>PME parameters can be modified: PMEparameters=[alpha_separation,numgridpoints_X,numgridpoints_Y,numgridpoints_Z]</p></li>
<li><p>The ewalderrortolerance can be modified (default: 1e-5)</p></li>
<li><p>The periodic nonbonded cutoff can be modified. Default: 12 Å</p></li>
<li><p>Long-range dispersion correction can be turned on or off.</p></li>
<li><p>The switching function distance can be changed. Default: 10 Å. Used for CHARMM and XML files.</p></li>
</ul>
</div>
<div class="section" id="molecular-dynamics-via-openmm">
<h2>Molecular Dynamics via OpenMM<a class="headerlink" href="#molecular-dynamics-via-openmm" title="Permalink to this headline">¶</a></h2>
<p>It is possible to run MM molecular dynamics of system using the OpenMMTheory object created.
This is accomplished directly via the MD algorithms present in the OpenMM library.
The OpenMM_MD function takes as argument an ASH fragment, an OpenMMTheory object and then the user can select an integrator of choice, simulation temperature, simulation length, timestep, optional additional thermostat, barostat etc.</p>
<p>Most general options available in OpenMM are available in this interface.
See OpenMM documentation page: <a class="reference external" href="http://docs.openmm.org/latest/userguide/application.html#integrators">http://docs.openmm.org/latest/userguide/application.html#integrators</a>  for details about the integrators, thermostats, barostats etc.</p>
<ul class="simple">
<li><p>Available Integrators: Langevin, LangevinMiddleIntegrator, NoseHooverIntegrator, VerletIntegrator, VariableLangevinIntegrator, VariableVerletIntegrator</p></li>
<li><p>Available Barostat: MonteCarloBarostat</p></li>
<li><p>Optional additional thermostat: Anderson</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">simulation_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">integrator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">barostat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">trajectory_file_option</span><span class="o">=</span><span class="s1">&#39;PDB&#39;</span><span class="p">,</span> <span class="n">coupling_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anderson_thermostat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="n">enforcePeriodicBox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frozen_atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</pre></div>
</div>
<p>Options:</p>
<ul class="simple">
<li><p>fragment: ASH Fragment object.</p></li>
<li><p>openmmobject: ASH OpenMMTheory object.</p></li>
<li><p>timestep: float (default: 0.001 ps). Size of timestep in picoseconds.</p></li>
<li><p>simulation_steps: integer. Number of steps to take. (Use either simulation_steps or simulation_time)</p></li>
<li><p>simulation_time: integer. Length of simulation time in ps. (Use either simulation_steps or simulation_time)</p></li>
<li><p>temperature: integer (default:300). Temperature in Kelvin</p></li>
<li><p>integrator: string (regular integrator or integrator+thermostat, e.g. ‘LangevinMiddleIntegrator’)</p></li>
<li><p>barostat: string (e.g. ‘MonteCarloBarostat’). Whether to add barostat to simulation for NPT simulations.</p></li>
<li><p>coupling_frequency: frequency (ps^-1) to update thermostat/integrator. Applies to Nose-Hoover/Langevin.</p></li>
<li><p>anderson_thermostat: Boolean (default: False)</p></li>
<li><p>trajectory_file_option: ‘PDB’ or ‘DCD’. Creates an ASCII PDB-trajectory or a compressed DCD trajectory.</p></li>
<li><p>traj_frequency: integer (default: 1000). How often to write coordinates to trajectory file (every nth step)</p></li>
<li><p>enforcePeriodicBox: Boolean (default: False). Option to fix PBC-image artifacts in trajectory.</p></li>
<li><p>frozen_atoms: list (default: None). What atom indices to freeze in simulation (masses = zero). Note: ASH counts from zero.</p></li>
<li><p>constraints: list of lists (default: None). [[atom_i,atom_j,distance]] Each list defines an atom-pair that is constrained with optionally the bond distance specified.   Example: constraints=[[827,830], [830,833, 1.010]].  Only bond constraints available for now.</p></li>
<li><p>restraints: list of lists (default: None). [[atom_i,atom_j,distance,force_constant]] Example: restraints=[[830,833, 1.010, 1000.0]]  where 830,833 are atom indices, 1.010 is the distance in Å and 1000.0 is the force-constant in kcal/mol *Å^-2. Only bond restraints available for now.</p></li>
<li><p>autoconstraints: string (default: None) Options: ‘HBonds’ (X-H bonds constrained), ‘AllBonds’ (all bonds constrained), ‘HAngles’ (all bonds and H-X-H and H-O-X angles constrained) or None (default).  Only affects OpenMM_MD runs.</p></li>
<li><p>hydrogenmass: integer (default: None) Mass of hydrogens (e.g. set to 2 for deuterium). Only affects OpenMM_MD runs.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Forcefield parameters</span>
<span class="n">forcefielddir</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/ASH-DEV_GIT/testsuite/OpenMM-files-for-tests/dhfr/charmm/&quot;</span>
<span class="n">psffile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;step3_pbcsetup.psf&quot;</span>
<span class="n">topfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;top_all36_prot.rtf&quot;</span>
<span class="n">prmfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;par_all36_prot.prm&quot;</span>

<span class="c1">#Defining fragment</span>
<span class="n">xyzfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;file.xyz&quot;</span>
<span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="n">xyzfile</span><span class="p">,</span> <span class="n">conncalc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Defining OpenMM theory object: CHARMM forcefield with periodic boundary conditions</span>
<span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span> <span class="n">CHARMMfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmmtopfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span>
    <span class="n">charmmprmfile</span><span class="o">=</span><span class="n">prmfile</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmm_periodic_cell_dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
    <span class="n">dispersion_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">periodic_nonbonded_cutoff</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">switching_function_distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">PMEparameters</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">0.34</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>

<span class="c1">#Launching a molecular dynamics simulation</span>
<span class="n">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">integrator</span><span class="o">=</span><span class="s1">&#39;LangevinMiddleIntegrator&#39;</span><span class="p">,</span> <span class="n">coupling_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">trajectory_file_option</span><span class="o">=</span><span class="s1">&#39;DCD&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>General constraints or H-mass modification:</strong></p>
<ul class="simple">
<li><p>In order to allow shorter timesteps in MD simulations it is common to utilize some general constraints in biomolecular simulations, e.g. all X-H bonds, all bonds or even all-bond and some angles. This can be accomplished  via the autoconstraints option (NOTE: an option to OpenMMTheory rather than OpenMM_MD). autoconstraints can be set to: ‘HBonds’ (X-H bonds constrained), ‘AllBonds’ (all bonds constrained), ‘HAngles’ (all bonds and H-X-H and H-O-X angles constrained) or None (default)</p></li>
<li><p>An alternative (or addition) is to change the masses of the hydrogen atoms (fastest-moving atoms). This is also an option to OpenMMTheory. hydrogenmass keyword takes an integer and can e.g. be 2 (mass of deuterium) or heavier. hydrogenmass=None is default (no changes to hydrogen masses).</p></li>
</ul>
<p>General X-H constraints and deuterium-mass example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Forcefield parameters</span>
<span class="n">forcefielddir</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/ASH-DEV_GIT/testsuite/OpenMM-files-for-tests/dhfr/charmm/&quot;</span>
<span class="n">psffile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;step3_pbcsetup.psf&quot;</span>
<span class="n">topfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;top_all36_prot.rtf&quot;</span>
<span class="n">prmfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;par_all36_prot.prm&quot;</span>

<span class="c1">#Defining fragment</span>
<span class="n">xyzfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;file.xyz&quot;</span>
<span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="n">xyzfile</span><span class="p">,</span> <span class="n">conncalc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Defining OpenMM theory object: CHARMM forcefield with periodic boundary conditions</span>
<span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span> <span class="n">CHARMMfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmmtopfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span>
    <span class="n">charmmprmfile</span><span class="o">=</span><span class="n">prmfile</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmm_periodic_cell_dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">autoconstraints</span><span class="o">=</span><span class="s1">&#39;HBonds&#39;</span><span class="p">,</span> <span class="n">hydrogenmass</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#Launching a molecular dynamics simulation</span>
<span class="n">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">integrator</span><span class="o">=</span><span class="s1">&#39;LangevinMiddleIntegrator&#39;</span><span class="p">,</span> <span class="n">coupling_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">trajectory_file_option</span><span class="o">=</span><span class="s1">&#39;DCD&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Dealing with PBC image problems in trajectory. See <a class="reference external" href="https://github.com/openmm/openmm/wiki/Frequently-Asked-Questions#how-do-periodic-boundary-conditions-work">https://github.com/openmm/openmm/wiki/Frequently-Asked-Questions#how-do-periodic-boundary-conditions-work</a>
To obtain a more pleasing visualization of the trajectory you can “reimage” the trajectory afterwards using the program mdtraj (requires installation of mdtraj: pip install mdtraj)</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#Provide trajectory file, PDB topology file and final format of trajectory</span>
<span class="n">MDtraj_imagetraj</span><span class="p">(</span><span class="s2">&quot;output_traj.dcd&quot;</span><span class="p">,</span> <span class="s2">&quot;final_MDfrag_laststep.pdb&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;DCD&#39;</span><span class="p">)</span>

<span class="c1">#If periodic box info is missing from trajectory file (can happen with CHARMM files):</span>
<span class="n">MDtraj_imagetraj</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">pdbtopology</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;DCD&#39;</span><span class="p">,</span> <span class="n">unitcell_lengths</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">unitcell_angles</span><span class="o">=</span><span class="p">[</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-minimization-via-openmm">
<h2>Simple minimization via OpenMM<a class="headerlink" href="#simple-minimization-via-openmm" title="Permalink to this headline">¶</a></h2>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Forcefield parameters</span>
<span class="n">forcefielddir</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/ASH-DEV_GIT/testsuite/OpenMM-files-for-tests/dhfr/charmm/&quot;</span>
<span class="n">psffile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;step3_pbcsetup.psf&quot;</span>
<span class="n">topfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;top_all36_prot.rtf&quot;</span>
<span class="n">prmfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;par_all36_prot.prm&quot;</span>

<span class="c1">#Defining fragment</span>
<span class="n">xyzfile</span><span class="o">=</span><span class="n">forcefielddir</span><span class="o">+</span><span class="s2">&quot;file.xyz&quot;</span>
<span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="n">xyzfile</span><span class="p">,</span> <span class="n">conncalc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Defining OpenMM theory object: CHARMM forcefield with periodic boundary conditions</span>
<span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span> <span class="n">CHARMMfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmmtopfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span>
    <span class="n">charmmprmfile</span><span class="o">=</span><span class="n">prmfile</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmm_periodic_cell_dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>

<span class="c1">#Launching a minimization</span>
<span class="n">OpenMM_Opt</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#After minimization, the ASH fragment is updated, a PDB-file is written out: frag-minimized.pdb</span>
<span class="c1">#Alternative XYZ write-out:</span>
<span class="n">frag</span><span class="o">.</span><span class="n">write_xyzfile</span><span class="p">(</span><span class="n">xyzfilename</span><span class="o">=</span><span class="s2">&quot;frag_afteropt.xyz&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to do a simple minimization of only the H-atoms of your system (e.g. your protein with newly added H-atoms),
you can do this by freezing all non-H atoms. An ASH fragment can conveniently give you lists of atom indices by the built-in functions:</p>
<ul class="simple">
<li><p>fragment.get_atomindices_for_element(‘C’)   #List of atom-indices for carbon atoms in the system</p></li>
<li><p>fragment.get_atomindices_except_element(‘H’)   #List of atom-indices for all atoms except the chosen element (here H).</p></li>
</ul>
<p>Note: all constraints in the OpenMM object needs to be turned off for (autoconstraints=None, rigidwater=False) for this many frozen atoms (frozen atoms can not have constraints).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">pdbfile</span> <span class="o">=</span> <span class="s2">&quot;ash_inp.pdb&quot;</span>
<span class="n">prmtopfile</span> <span class="o">=</span> <span class="s2">&quot;prmtop&quot;</span>

<span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="p">(</span><span class="n">pdbfile</span><span class="o">=</span><span class="n">pdbfile</span><span class="p">)</span>

<span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">Amberfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">amberprmtopfile</span><span class="o">=</span><span class="n">prmtopfile</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;CPU&#39;</span><span class="p">,</span> <span class="n">autoconstraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rigidwater</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#List of all non-H atoms</span>
<span class="n">allnonHatoms</span><span class="o">=</span><span class="n">frag</span><span class="o">.</span><span class="n">get_atomindices_except_element</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">integrator</span><span class="o">=</span><span class="s2">&quot;LangevinIntegrator&quot;</span><span class="p">,</span>
        <span class="n">coupling_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">trajectory_file_option</span><span class="o">=</span><span class="s2">&quot;PDB&quot;</span><span class="p">,</span> <span class="n">frozen_atoms</span><span class="o">=</span><span class="n">allnonHatoms</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="section" id="system-setup-via-openmm-modeller">
<h2>System setup via OpenMM: Modeller<a class="headerlink" href="#system-setup-via-openmm-modeller" title="Permalink to this headline">¶</a></h2>
<p>OpenMM features a convenient PDBfixer program (<a class="reference external" href="https://github.com/openmm/pdbfixer">https://github.com/openmm/pdbfixer</a>) and a Modeller tool (<a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/simtk.openmm.app.modeller.Modeller.html">http://docs.openmm.org/latest/api-python/generated/simtk.openmm.app.modeller.Modeller.html</a>)
that is capable of setting up a new biomolecular system from scratch. See also: <a class="reference external" href="http://docs.openmm.org/7.2.0/userguide/application.html#model-building-and-editing">http://docs.openmm.org/7.2.0/userguide/application.html#model-building-and-editing</a>
ASH features a highly convenient interface to these programs and allows near-automatic system-setup for favorable systems.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OpenMM_Modeller</span><span class="p">(</span><span class="n">pdbfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">forcefield</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmlfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">waterxmlfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">watermodel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span>
                <span class="n">solvent_padding</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">solvent_boxdims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extraxmlfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residue_variants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">ionicstrength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">iontype</span><span class="o">=</span><span class="s1">&#39;K+&#39;</span><span class="p">):</span>
</pre></div>
</div>
<p>Lysozyme example (simple, no modifications required):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Original raw PDB-file (no hydrogens, nosolvent)</span>
<span class="c1">#Download from https://www.rcsb.org/structure/1AKI</span>
<span class="n">pdbfile</span><span class="o">=</span><span class="s2">&quot;1aki.pdb&quot;</span>


<span class="c1">#Defining residues with special user-wanted protonation states</span>
<span class="c1">#Example: residue_variants={0:&#39;LYN&#39;, 17:&#39;CYX&#39;, 18:&#39;ASH&#39;, 19:&#39;HIE&#39; }</span>
<span class="c1">#residue 0 neutral LYS, residue 17, deprotonated CYS, residue 18 protonated ASP, residue 19 epsilon-protonated HIS.</span>
<span class="n">residue_variants</span><span class="o">=</span><span class="p">{}</span>

<span class="c1">#Setting up new system, adding hydrogens, solvent, ions and defining forcefield, topology</span>
<span class="n">forcefield</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">ashfragment</span> <span class="o">=</span> <span class="n">OpenMM_Modeller</span><span class="p">(</span><span class="n">pdbfile</span><span class="o">=</span><span class="n">pdbfile</span><span class="p">,</span> <span class="n">forcefield</span><span class="o">=</span><span class="s1">&#39;CHARMM36&#39;</span><span class="p">,</span> <span class="n">watermodel</span><span class="o">=</span><span class="s2">&quot;tip3p&quot;</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span>
    <span class="n">solvent_padding</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">ionicstrength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">iontype</span><span class="o">=</span><span class="s2">&quot;Na+&quot;</span><span class="p">,</span> <span class="n">residue_variants</span><span class="o">=</span><span class="n">residue_variants</span><span class="p">)</span>

<span class="c1">#Creating new OpenMM object from forcefield, topology and and fragment</span>
<span class="n">openmmobject</span> <span class="o">=</span><span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;CPU&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span> <span class="n">Modeller</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">forcefield</span><span class="o">=</span><span class="n">forcefield</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="n">topology</span><span class="p">,</span>
                 <span class="n">pdbfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_energy_decomposition</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">autoconstraints</span><span class="o">=</span><span class="s1">&#39;HBonds&#39;</span><span class="p">,</span> <span class="n">rigidwater</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#MM minimization for 100 steps</span>
<span class="n">OpenMM_Opt</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">ashfragment</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Classical MD simulation for 10 ps</span>
<span class="n">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">ashfragment</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">integrator</span><span class="o">=</span><span class="s1">&#39;LangevinMiddleIntegrator&#39;</span><span class="p">,</span> <span class="n">coupling_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">trajectory_file_option</span><span class="o">=</span><span class="s1">&#39;DCD&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the protein contains nonstandard residues (e.g. metalcofactors) that are not present in a typical protein forcefield (OpenMM_Modeller will exit with errors),
then these need to be provided using the extraxmlfile option.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">forcefield</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">ashfragment</span> <span class="o">=</span> <span class="n">OpenMM_Modeller</span><span class="p">(</span><span class="n">pdbfile</span><span class="o">=</span><span class="n">pdbfile</span><span class="p">,</span> <span class="n">forcefield</span><span class="o">=</span><span class="s1">&#39;CHARMM36&#39;</span><span class="p">,</span> <span class="n">watermodel</span><span class="o">=</span><span class="s2">&quot;tip3p&quot;</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span>
    <span class="n">solvent_padding</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">ionicstrength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">iontype</span><span class="o">=</span><span class="s2">&quot;Na+&quot;</span><span class="p">,</span> <span class="n">residue_variants</span><span class="o">=</span><span class="n">residue_variants</span><span class="p">,</span> <span class="n">extraxmlfile</span><span class="o">=</span><span class="s2">&quot;cofactor.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The cofactor.xml file needs to define a forcefield (a nonbonded one at least) for the residue.
Here defining a dummy molybdenum ion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ForceField</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">AtomTypes</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Type</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MOX&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;Mo&quot;</span> <span class="n">element</span><span class="o">=</span><span class="s2">&quot;Mo&quot;</span> <span class="n">mass</span><span class="o">=</span><span class="s2">&quot;99.0&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">AtomTypes</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Residues</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Residue</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FEM&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Atom</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MOD&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;MOX&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">Residue</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">Residues</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">NonbondedForce</span> <span class="n">coulomb14scale</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">lj14scale</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Atom</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;MOX&quot;</span> <span class="n">charge</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.375&quot;</span> <span class="n">epsilon</span><span class="o">=</span><span class="s2">&quot;0.439&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">NonbondedForce</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ForceField</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Advanced example (additional forcefield parameters required):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1">#TODO</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="QM-MM-protein.html" class="btn btn-neutral float-right" title="QM/MM on a protein" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="knarr-interface.html" class="btn btn-neutral float-left" title="knarr interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Ragnar Bjornsson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>