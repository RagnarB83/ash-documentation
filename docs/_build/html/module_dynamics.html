<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Molecular dynamics &mdash; Ash 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Nudged Elastic Band Method" href="neb.html" />
    <link rel="prev" title="Frequency calculation" href="module_freq.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="index.html" class="icon icon-home"> Ash
            <img src="_static/ash-simple-logo-letterbig.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About.html">About ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-examples.html">Basic examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ash_program_philosophy.html">ASH Program Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate-input.html">Coordinates and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallelization.html">Parallelization in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-interfaces.html">QM Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="MM-interfaces.html">MM Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jobtypes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="job-types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlepoint.html">Singlepoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_freq.html">Frequency calculation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Molecular dynamics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dynamics-via-ase">Dynamics via ASE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamics-via-openmm-md">Dynamics via OpenMM_MD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metadynamics-via-ase-and-plumed">Metadynamics via ASE and Plumed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metadynamics-via-openmm-md-and-plumed">Metadynamics via OpenMM_MD and Plumed</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="neb.html">Nudged Elastic Band Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="surfacescan.html">Surface Scans</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="module_QM-MM.html">QM/MM Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_benchmarking.html">Benchmarking in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_highlevel_workflows.html">Highlevel workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_molcrys.html">MOLCRYS: Automatic QM/MM for Molecular Crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_PES.html">PES: PhotoElectron/PhotoEmission Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_plotting.html">Plotting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ORCA-interface.html">ORCA interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="xTB-interface.html">xTB interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRCC-interface.html">MRCC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="CFour-interface.html">CFour interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="PySCF-interface.html">PySCF interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Psi4-interface.html">Psi4 interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="crest-interface.html">CREST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomeTRIC-interface.html">geomeTRIC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="knarr-interface.html">KNARR interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenMM-interface.html">OpenMM interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Explicit-solvation.html">Explicit solvation (small molecule)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-I.html">Metalloprotein tutorial I: Rubredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-II.html">Metalloprotein tutorial II: Ferredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-MM-protein.html">QM/MM on a protein</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows-examples.html">Workflow examples in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermochemistry.html">High-level Thermochemistry in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="Highlevel_CC_CBS_workflows.html">Tutorial: High-level CCSD(T)/CBS workflows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coordinate-tools.html">Coordinates and fragment tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ash</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Molecular dynamics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/module_dynamics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="molecular-dynamics">
<h1>Molecular dynamics<a class="headerlink" href="#molecular-dynamics" title="Permalink to this headline"></a></h1>
<p>Molecular dynamics in ASH is currently available via 2 different approaches.</p>
<ul class="simple">
<li><p>The more general approach make use of an interface to the dynamics routines of the ASE library. This allows molecular dynamics to be performed via any theory level in ASH: QM, MM or QM/MM theory. This requires the <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/">ASE</a>  library to be installed (simple Python pip installation). In the future, ASH will feature it’s own native dynamics.</p></li>
<li><p>The more specialized approach uses an interface to the MM dynamics routines of OpenMM library. This is only available for theory levels: OpenMMTheory (i.e. pure classical simulations) and QMMMTheory (with mm_theory=OpenMMTheoryobject). This approach makes the most sense when a considerable amount of time is spent on calculating the MM energy+gradient via OpenMM (faster than the Dynamics_ASE approach)</p></li>
</ul>
<div class="section" id="dynamics-via-ase">
<h2>Dynamics via ASE<a class="headerlink" href="#dynamics-via-ase" title="Permalink to this headline"></a></h2>
<p>The Dynamics_ASE function allows NVE and NVT based molecular dynamics in ASH using any available QM, MM or QM/MM theory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Dynamics_ASE</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thermostat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">simulation_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">barostat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trajectoryname</span><span class="o">=</span><span class="s2">&quot;Trajectory_ASE&quot;</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">coupling_freq</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span>
                        <span class="n">frozen_atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frozen_bonds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frozen_angles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frozen_dihedrals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plumed_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</pre></div>
</div>
<p>In order to use the Dynamics_ASE function, <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/">ASE</a> must have been installed before to the same Python that ASH uses (easiest done via: pip install ase).</p>
<p>Simple NVE example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">12</span>
<span class="c1">#Simple n-butane system</span>
<span class="n">butane</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;butane.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Creating xTBTheory object (Note: runmode=&#39;library&#39; runs faster) that is parallelized. Using GFN1-xTB.</span>
<span class="n">xtbcalc</span> <span class="o">=</span> <span class="n">xTBTheory</span><span class="p">(</span><span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN1&#39;</span><span class="p">,</span> <span class="n">runmode</span><span class="o">=</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Running NVE dynamics (initial temp=300 K) on butane using xTBTheory.</span>
<span class="c1"># 0.001 ps timestep, 100000 steps, writing every 10th step to trajectory. A velocity Verlet algorithm is used.</span>
<span class="n">Dynamics_ASE</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">butane</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">xtbcalc</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">300.0</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Simple NVT (Langevin thermostat) example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Running NVT dynamics with a Langevin thermostat on butane using xTBTheory</span>
<span class="c1"># 0.001 ps timestep, 100000 steps, writing every 10th step to trajectory.</span>
<span class="n">Dynamics_ASE</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">butane</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">xtbcalc</span><span class="p">,</span> <span class="n">thermostat</span><span class="o">=</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="n">coupling_freq</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mf">300.0</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Thermostat options: ‘Langevin’, ‘Andersen’, ‘NoseHoover’, ‘Berendsen’.</p>
<p>coupling_freq determines friction-coefficient in Langevin, collions probability in Andersen.</p>
<p>It is possible to freeze atoms using frozen_atoms= option. Provide list of atom indices.</p>
<p>Bonds, angles and dihedrals can be frozen using frozen_bonds=, frozen_angles= and frozen_dihedrals= options.</p>
</div>
<div class="section" id="dynamics-via-openmm-md">
<h2>Dynamics via OpenMM_MD<a class="headerlink" href="#dynamics-via-openmm-md" title="Permalink to this headline"></a></h2>
<p>For pure classical forcefield-based MD it is recommended to run the dynamics via the OpenMM library instead via the ASH <strong>OpenMM_MD</strong> function. The reason is that this results in essentially no data transfer between the C++ layer (of OpenMM) and Python layer (of OpenMM and ASH) while this is the case if running via Dynamics_ASE. Dynamics via OpenMM_MD requires the system to have been set up using OpenMMTheory and utilizes the OpenMM library for energy, forces and dynamics. See <a class="reference internal" href="OpenMM-interface.html"><span class="doc">OpenMM interface</span></a> for details.</p>
<p><strong>Pure MM example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Fragment</span>
<span class="n">frag</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;frag.xyz&quot;</span><span class="p">)</span>
<span class="c1">#Defining frozen region. Taking difference of all-atom region and active region</span>
<span class="n">actatoms</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
<span class="n">frozen_atoms</span><span class="o">=</span><span class="n">listdiff</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">allatoms</span><span class="p">,</span><span class="n">actatoms</span><span class="p">)</span>

<span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">cluster_fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">ASH_FF_file</span><span class="o">=</span><span class="s2">&quot;Cluster_forcefield.ff&quot;</span><span class="p">,</span> <span class="n">frozen_atoms</span><span class="o">=</span><span class="n">frozen_atoms</span><span class="p">)</span>

<span class="n">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">integrator</span><span class="o">=</span><span class="s1">&#39;LangevinIntegrator&#39;</span><span class="p">,</span> <span class="n">coupling_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>For a QM/MM system that utilizes OpenMMTheory as mm_theory and any QM-theory as qm_theory, it is also possible to use OpenMM_MD to do QM/MM dynamics. In this case the QM+PC gradient is used to update the forces of the OpenMM system (as a CustomExternalForce)
This is beneficial if a considerable amount of time of the QM/MM energy+gradient is spent on calculating the MM energy+gradient and then there the reduced data transfer (and unnecessary data conversion) between the Python and C++ layers results in faster MM energy+gradient steps. This is only the case if the QM-theory is really cheap (i.e. a semi-empirical method like xTB or AM1, PM3), otherwise the QM energy+gradient will dominate the total cost. See <a class="reference internal" href="OpenMM-interface.html"><span class="doc">OpenMM interface</span></a> for details.</p>
<p><strong>QM/MM example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

    <span class="c1">#Fragment</span>
    <span class="n">frag</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;frag.xyz&quot;</span><span class="p">)</span>
    <span class="c1">#Defining frozen region. Taking difference of all-atom region and active region</span>
    <span class="n">actatoms</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">frozen_atoms</span><span class="o">=</span><span class="n">listdiff</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">allatoms</span><span class="p">,</span><span class="n">actatoms</span><span class="p">)</span>

    <span class="n">xtbtheory</span> <span class="o">=</span> <span class="n">xTBTheory</span><span class="p">(</span><span class="n">runmode</span><span class="o">=</span><span class="s1">&#39;inputfile&#39;</span><span class="p">,</span> <span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN2&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">cluster_fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">ASH_FF_file</span><span class="o">=</span><span class="s2">&quot;Cluster_forcefield.ff&quot;</span><span class="p">,</span> <span class="n">frozen_atoms</span><span class="o">=</span><span class="n">frozen_atoms</span><span class="p">)</span>
    <span class="n">QMMMTheory</span> <span class="o">=</span> <span class="n">QMMMTheory</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">qm_theory</span><span class="o">=</span><span class="n">xtbtheory</span><span class="p">,</span> <span class="n">mm_theory</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">,</span>
<span class="n">qmatoms</span><span class="o">=</span><span class="n">qm_region</span><span class="p">,</span> <span class="n">embedding</span><span class="o">=</span><span class="s1">&#39;Elstat&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

    <span class="n">OpenMM_MD</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">QMMMTheory</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">integrator</span><span class="o">=</span><span class="s1">&#39;LangevinIntegrator&#39;</span><span class="p">,</span> <span class="n">coupling_frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="metadynamics-via-ase-and-plumed">
<h2>Metadynamics via ASE and Plumed<a class="headerlink" href="#metadynamics-via-ase-and-plumed" title="Permalink to this headline"></a></h2>
<p>Via an interface to the <a class="reference external" href="https://www.plumed.org">Plumed</a> library it is possible to perform metadynamics in ASH. Any theory level in ASH is supported (including QM/MM theories).</p>
<p>Requirements:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.fysik.dtu.dk/ase/">ASE</a> library (see above)</p></li>
<li><p><a class="reference external" href="https://www.plumed.org">Plumed</a> installation (requires compilation). Alternatively it might be possible to install via <a class="reference external" href="https://anaconda.org/conda-forge/plumed">conda-forge</a> (untested)</p></li>
<li><p>Plumed Python wrappers (pip install plumed)</p></li>
</ul>
<p>1D metadynamics example (torsion):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">12</span>

<span class="c1">#Simple n-butane system</span>
<span class="n">frag</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;butane.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Creating xTBTheory object (Note: runmode=&#39;library&#39; runs faster) that is parallelized</span>
<span class="n">xtbcalc</span> <span class="o">=</span> <span class="n">xTBTheory</span><span class="p">(</span><span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN1&#39;</span><span class="p">,</span> <span class="n">runmode</span><span class="o">=</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Create ASH-Plumed object. Points to Plumed kernel and defines collective variables etc.</span>
<span class="n">plumed_object</span> <span class="o">=</span> <span class="n">plumed_ASH</span><span class="p">(</span><span class="n">path_to_plumed_kernel</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/plumed-install-serial/lib/libplumedKernel.so&quot;</span><span class="p">,</span>
                                <span class="n">bias_type</span><span class="o">=</span><span class="s2">&quot;MTD&quot;</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">CV1_type</span><span class="o">=</span><span class="s2">&quot;TORSION&quot;</span><span class="p">,</span> <span class="n">CV1_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
                <span class="n">temperature</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">hills_file</span><span class="o">=</span><span class="s2">&quot;HILLS&quot;</span><span class="p">,</span> <span class="n">colvar_file</span><span class="o">=</span><span class="s2">&quot;COLVAR&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.012</span><span class="p">,</span>
                <span class="n">sigma1</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">biasfactor</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">stride_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pace_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Call ASH-ASE dynamics with plumed_object. Here running 100K steps with 1 fs timstep, writing trajectory every 10th step.</span>
<span class="n">Dynamics_ASE</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">xtbcalc</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">plumed_object</span><span class="o">=</span><span class="n">plumed_object</span><span class="p">)</span>

<span class="c1">#Analyze the results of the metadynamics</span>
<span class="n">MTD_analyze</span><span class="p">(</span><span class="n">path_to_plumed</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/plumed-install-serial&quot;</span><span class="p">,</span> <span class="n">Plot_To_Screen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">colvar_type</span><span class="o">=</span><span class="s2">&quot;Torsion&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">CV1atoms</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>2D metadynamics example (torsion,distance):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">12</span>

<span class="c1">#Simple n-butane system</span>
<span class="n">frag</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;butane.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Creating xTBTheory object (Note: runmode=&#39;library&#39; runs faster) that is parallelized</span>
<span class="n">xtbcalc</span> <span class="o">=</span> <span class="n">xTBTheory</span><span class="p">(</span><span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN1&#39;</span><span class="p">,</span> <span class="n">runmode</span><span class="o">=</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Create ASH-Plumed object. Points to Plumed kernel and defines collective variables etc.</span>
<span class="n">plumed_object</span> <span class="o">=</span> <span class="n">plumed_ASH</span><span class="p">(</span><span class="n">path_to_plumed_kernel</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/plumed-install-serial/lib/libplumedKernel.so&quot;</span><span class="p">,</span>
                                <span class="n">bias_type</span><span class="o">=</span><span class="s2">&quot;MTD&quot;</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">CV1_type</span><span class="o">=</span><span class="s2">&quot;TORSION&quot;</span><span class="p">,</span> <span class="n">CV1_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">CV2_type</span><span class="o">=</span><span class="s2">&quot;DISTANCE&quot;</span><span class="p">,</span> <span class="n">CV2_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">temperature</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">hills_file</span><span class="o">=</span><span class="s2">&quot;HILLS&quot;</span><span class="p">,</span> <span class="n">colvar_file</span><span class="o">=</span><span class="s2">&quot;COLVAR&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.012</span><span class="p">,</span>
                <span class="n">sigma1</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">biasfactor</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">stride_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pace_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Call ASH-ASE dynamics with plumed_object. Here running 100K steps with 1 fs timstep, writing trajectory every 10th step.</span>
<span class="n">Dynamics_ASE</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">xtbcalc</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">simulation_steps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">traj_frequency</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">plumed_object</span><span class="o">=</span><span class="n">plumed_object</span><span class="p">)</span>

<span class="c1">#Analyze the results of the metadynamics</span>
<span class="n">MTD_analyze</span><span class="p">(</span><span class="n">path_to_plumed</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/plumed-install-serial&quot;</span><span class="p">,</span> <span class="n">Plot_To_Screen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">colvar_type</span><span class="o">=</span><span class="s2">&quot;Torsion&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">CV1atoms</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>ASH Plumed class keywords:</p>
<ul class="simple">
<li><p>path_to_plumed_kernel (string). Should give full path to the libplumedKernel.so file in Plumed installation.</p></li>
<li><p>bias_type (string). Current options: “MTD” (for metadynamics job)   (more to come…)</p></li>
<li><p>fragment (ASH fragment). The ASH fragment for the system.</p></li>
<li><p>CV1_type/CV2_type (string). Type of collective variable 1 (Plumed keyword). Options: TORSION, DISTANCE, ANGLE, RMSD (and more in principle)</p></li>
<li><p>CV1_indices/CV2_indices (list). List of atom indices that defines the chosen torsion, distance, angle (note: use 0-based indexing)</p></li>
<li><p>temperature (float). The temperature provided to Plumed (in Kelvin). Used in well-tempered MTD</p></li>
<li><p>hills_file (string). Name of HILLS-file (default HILLS).</p></li>
<li><p>colvar_file (string). Name of COLVAR-file (default COLVAR).</p></li>
<li><p>height (float). The height of the Gaussian in energy-unit eV. Default: 0.01243 eV (= 1.2 kJ/mol)</p></li>
<li><p>sigma1/sigma2 (float). The width of the Gaussian in CV units for each CV defined. Depends on CV-type. Example: sigma1=0.35 radians(torsion), sigma=0.5 Å (distance).</p></li>
<li><p>biasfactor (float). Parameter used in well-tempered metadynamics. Default: 6.0</p></li>
<li><p>timestep (float). The timestep (in ps) provided to Plumed.</p></li>
<li><p>stride_num (int). Frequency of writing to COLVAR file. Default: 10</p></li>
<li><p>pace_num (int). Frequency of writing to HILLS file. Default: 500</p></li>
<li><p>numwalkers (int). Number of walkers used for multiple walker metadynamics. CURRENTLY INACTIVE</p></li>
</ul>
<p>About the ASH-Plumed interface:</p>
<ul class="simple">
<li><p>Well-tempered metadynamics is always specified in the current interface (regular metadynamics is a largely obsolete method).</p></li>
<li><p>Only 1D and 2D metadynamics currently possible.</p></li>
<li><p>ASH uses the same units for distance (Å), energy (eV) and time (ps) as the dynamics program (currently ASE). Radians are used for torsions. This is different from the default Plumed units (nm for distances and kJ/mol for energy). Keep this in mind when defining sigma (width of Gaussian in CV-unit) and height (of Gaussian in energy-unit).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not yet available: multiple-walker metadynamics</p>
</div>
</div>
<div class="section" id="metadynamics-via-openmm-md-and-plumed">
<h2>Metadynamics via OpenMM_MD and Plumed<a class="headerlink" href="#metadynamics-via-openmm-md-and-plumed" title="Permalink to this headline"></a></h2>
<p>to be documented</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="module_freq.html" class="btn btn-neutral float-left" title="Frequency calculation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="neb.html" class="btn btn-neutral float-right" title="Nudged Elastic Band Method" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Ragnar Bjornsson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXX-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-XXXXXXX-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>