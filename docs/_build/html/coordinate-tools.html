

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Coordinates and fragment tools &mdash; Ash 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="High-level Thermochemistry in ASH" href="thermochemistry.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> Ash
          

          
            
            <img src="_static/ash-simple-logo-letterbig.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About.html">About ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate-input.html">Coordinates and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="job-types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-interfaces.html">QM Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="MM-interfaces.html">MM Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Internal modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="module_QM-MM.html">QM/MM Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_benchmarking.html">Benchmarking in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_coords.html">Coords module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_dynamics.html">Dynamics module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_freq.html">Freq module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_workflows.html">Workflows module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_highlevel_workflows.html">Highlevel workflows module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_molcrys.html">MOLCRYS: Automatic QM/MM for Molecular Crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_PES.html">PES: PhotoElectron/PhotoEmission Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_plotting.html">Plotting</a></li>
</ul>
<p class="caption"><span class="caption-text">Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ORCA-interface.html">ORCA interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="xTB-interface.html">xTB interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRCC-interface.html">MRCC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="CFour-interface.html">CFour interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="PySCF-interface.html">PySCF interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Psi4-interface.html">Psi4 interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="crest-interface.html">CREST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomeTRIC-interface.html">geomeTRIC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="knarr-interface.html">knarr interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenMM-interface.html">OpenMM interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="QM-MM-protein.html">QM/MM on a protein</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows-examples.html">Workflow examples in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermochemistry.html">High-level Thermochemistry in ASH</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Coordinates and fragment tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modifying-coordinates-in-ash-calculations">Modifying coordinates in ASH calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-removing-atoms-of-an-mm-system"><strong>Adding/removing atoms of an MM system</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-pdb-files">Working with PDB files</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ash</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Coordinates and fragment tools</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/coordinate-tools.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="coordinates-and-fragment-tools">
<h1>Coordinates and fragment tools<a class="headerlink" href="#coordinates-and-fragment-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="modifying-coordinates-in-ash-calculations">
<h2>Modifying coordinates in ASH calculations<a class="headerlink" href="#modifying-coordinates-in-ash-calculations" title="Permalink to this headline">¶</a></h2>
<p>One often needs to manually modify coordinates in QM or QM/MM calculations. While this is straightforward when working
with small molecules and for example XYZ-files (open the coordinates in a simple molecular builder and modify) it is more
of an issue when working with a large system (e.g. a protein or a molecular crystal cluster) and you want to modify only a few atoms buried in the center of a 40 000 atom file.</p>
<ul class="simple">
<li><p>If one prefers to work with XYZ-files then it might be possible to use a program like VMD to modify certain coordinates there.</p></li>
<li><p>If one works with ASH fragment files (recommended) then one can modify the coordinates of a group of atoms via the use of scripts. These scripts are located in: /path/to/ashdir/ash/scripts and are called: <strong>fragedit.py</strong>  and <strong>fragupdate.py</strong></p></li>
</ul>
<p><strong>Grab and visualize part of the fragfile (fragedit.py)</strong></p>
<p>If one wants to visualize or possibly modify the coordinates of a group of atoms (e.g. the QM active site of a protein) then one can use the fragedit.py script like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 fragedit.py fragfile.ygg atomlistfile
</pre></div>
</div>
<p>The script will then read the ASH fragfile (fragfile.ygg) and extract the coordinates corresponding to atom indices present
in the atomlistfile. The atomlistfile should contain a list of atom indices in a single line : e.g. 1 2 3 4 5
By default, the fragedit.py will also search for a file called qmatoms and read the list of atoms from there.</p>
<p>This will create a file called fragment.xyz (coordinates in Å), containing only the part of the system (as defined by the atom indices).
This file can be visualized in a molecular builder (e.g. Chemcraft) and the coordinates can also be modified.</p>
<p><strong>Update the part of the system (fragupdate.py)</strong></p>
<p>If the coordinates were modified in the molecular builder they could be copied back to the fragment.xyz file (careful not to modify the header) and use the same
unit (Å). The fragfile (containing coordinates of the full system) can then be updated using the modified coordinates in fragment.xyz.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 fragupdate.py fragfile.ygg atomlistfile
</pre></div>
</div>
<p>This should update the coordinates of fragfile.ygg.</p>
</div>
<div class="section" id="adding-removing-atoms-of-an-mm-system">
<h2><strong>Adding/removing atoms of an MM system</strong><a class="headerlink" href="#adding-removing-atoms-of-an-mm-system" title="Permalink to this headline">¶</a></h2>
<p>If you need to add or remove atoms to your MM or QM/MM system this is a bit more involved than just modifying the coordinates. The reason is that both the coordinate and forcefield file needs to be updated and also: if you delete e.g. atom 4556 then all atom indices &gt; 4556 change.</p>
<p>There are two options:</p>
<ol class="arabic">
<li><p>Go back to the original MM-system preparation and prepare a new MM model with the added/deleted atom(s). This is a safe option but inconvenient.</p></li>
<li><p>Modify the coordinate-file (XYZ-file, YGG-file, PDB-file), the forcefield file (e.g. PSF-file, topology file) and update atom-indices-files (e.g. active_atoms and qmatoms files).</p>
<blockquote>
<div><ol class="loweralpha">
<li><dl>
<dt>CHARMM files:</dt><dd><p>The PSF-file has to be regenerated and the topology and parameter-files may also need modifications/additions.
PSFgen is the best option for creating a new PSF-file.</p>
<p><strong>Delete atoms (CHARMM)</strong></p>
<p>Both the coordinate-deletion and PSF-file update can be performed with an ASH script like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Path to dir containing PSFgen executable</span>
<span class="n">psfgendir</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/QM-MM-Chemshell-scripts&quot;</span>

<span class="c1">#CHARMM Forcefield files</span>
<span class="n">topfile</span><span class="o">=</span><span class="s2">&quot;top_all36_prot.rtf&quot;</span>
<span class="n">psffile</span><span class="o">=</span><span class="s2">&quot;newxplor.psf&quot;</span>

<span class="c1">#Reading coordinates into a fragment</span>
<span class="n">fragfile</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">fragfile</span><span class="o">=</span><span class="s2">&quot;Fragment-currentgeo.ygg&quot;</span><span class="p">)</span>

<span class="c1">#What atoms to delete</span>
<span class="n">deletionlist</span><span class="o">=</span><span class="p">[</span><span class="mi">18840</span><span class="p">]</span>

<span class="c1">#Delete atoms from system</span>
<span class="n">remove_atoms_from_system_CHARMM</span><span class="p">(</span><span class="n">atomindices</span><span class="o">=</span><span class="n">deletionlist</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">fragfile</span><span class="p">,</span><span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span><span class="n">topfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span> <span class="n">psfgendir</span><span class="o">=</span><span class="n">psfgendir</span><span class="p">)</span>
</pre></div>
</div>
<p>The script will delete the selected atoms (here 18840; note: ASH counts from zero) and create new fragmentfiles:
newfragment.xyz and newfragment.ygg
and create the new PSF file named: newsystem_XPLOR.psf  . Also created is a PDB-file: new-system.pdb</p>
<p>Remember that when you delete atoms from a system atom indices will have changed.
Remember to update the QM-region and Active-Region definitions!</p>
<p><strong>Add atoms to system (CHARMM)</strong></p>
<p>Both the coordinates and the PSF-file needs to be updated.
This can be performed with an ASH script like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Path to dir containing PSFgen executable</span>
<span class="n">psfgendir</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/QM-MM-Chemshell-scripts&quot;</span>

<span class="c1">#CHARMM Forcefield files</span>
<span class="n">topfile</span><span class="o">=</span><span class="s2">&quot;top_all36_prot.rtf&quot;</span>
<span class="n">psffile</span><span class="o">=</span><span class="s2">&quot;newxplor.psf&quot;</span>

<span class="c1">#Reading coordinates into a fragment</span>
<span class="n">fragfile</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">fragfile</span><span class="o">=</span><span class="s2">&quot;Fragment-currentgeo.ygg&quot;</span><span class="p">)</span>

<span class="c1">#Defining the added coordinates as a string</span>
<span class="n">addition_string</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">C        1.558526678      0.000000000     -0.800136464</span>
<span class="s2">O        2.110366050     -0.126832008      0.222773815</span>
<span class="s2">O        1.006687306      0.126832008     -1.823046743</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1">#Name of resgroup to be added (this needs to be present in topfile!)</span>
<span class="n">resgroup</span><span class="o">=</span><span class="s1">&#39;CO2&#39;</span>
<span class="c1">#Adding atoms</span>
<span class="n">add_atoms_to_system_CHARMM</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">fragfile</span><span class="p">,</span> <span class="n">added_atoms_coordstring</span><span class="o">=</span><span class="n">addition_string</span><span class="p">,</span> <span class="n">resgroup</span><span class="o">=</span><span class="n">resgroup</span><span class="p">,</span> <span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span> <span class="n">topfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span> <span class="n">psfgendir</span><span class="o">=</span><span class="n">psfgendir</span><span class="p">)</span>
</pre></div>
</div>
<p>The script will add the selected atom coordinates to the fragment (at the end) and create new fragmentfiles:
newfragment.xyz and newfragment.ygg
and add the chosen resgroup to a PSF file named: newsystem_XPLOR.psf  .
Also created is a PDB-file: new-system.pdb</p>
<p>Remember to add the new atom indices to QM-region and Active-Region definitions!</p>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="working-with-pdb-files">
<h2>Working with PDB files<a class="headerlink" href="#working-with-pdb-files" title="Permalink to this headline">¶</a></h2>
<p>WARNING: PDB files are convenient for visualization purposes and for initial reading in of coordinates but are
generally not a file format to be used (one problem is the limited number of significant digits used
for coordinates).</p>
<p><strong>Reading in PDB file</strong></p>
<p>It is possible to read in coordinates from a PDB file to create an ASH fragment file.
This functionality is very basic, it will only read in the coordinates, not atom-types
or residue information. Atomtypes and residue information can be read-in via a PSF-file
by OpenMMTheory (see <a class="reference internal" href="MM-interfaces.html"><span class="doc">MM Interfaces</span></a>).</p>
<p>This option should thus only be used to provide convenient starting coordinates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pdbfrag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="p">(</span><span class="n">pdbfile</span><span class="o">=</span><span class="s2">&quot;mol.pdb&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Writing out PDB file</strong></p>
<p>If you have an ASH fragment file created (loaded into memory), you can request to write out a PDB-file from it via the write_pdbfile function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_pdbfile</span><span class="p">(</span><span class="n">fragment</span><span class="p">,</span><span class="n">outputname</span><span class="o">=</span><span class="s2">&quot;ASHfragment&quot;</span><span class="p">,</span> <span class="n">openmmobject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atomnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">resnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">residlabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">segmentlabels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</pre></div>
</div>
<p>An ASH fragment file needs to always be provided, and then optionally the outputname (“ASHfragment.pdb” will be created by default).</p>
<ul class="simple">
<li><p>Example 1 (dummy):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">write_pdbfile</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span>
</pre></div>
</div>
<p>This will give you a PDB-file with the coordinates taken from inside the ASH fragment (here called frag) but without residue information (since none was provided).
All residues will be labelled ‘DUM’ and segments ‘SEG’, element information should be correct.</p>
<ul class="simple">
<li><p>Example 2 (manual correct specification):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">openmmobject</span> <span class="o">=</span> <span class="n">OpenMMTheory</span><span class="p">(</span><span class="n">psffile</span><span class="o">=</span><span class="n">psffile</span><span class="p">,</span> <span class="n">CHARMMfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charmmtopfile</span><span class="o">=</span><span class="n">topfile</span><span class="p">,</span><span class="n">charmmprmfile</span><span class="o">=</span><span class="n">parfile</span><span class="p">,</span>
                <span class="n">printlevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;CPU&#39;</span> <span class="p">)</span>
<span class="n">write_pdbfile</span><span class="p">(</span><span class="n">frag</span><span class="p">,</span> <span class="n">outputname</span><span class="o">=</span><span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="n">atomnames</span><span class="o">=</span><span class="n">openmmobject</span><span class="o">.</span><span class="n">atomnames</span><span class="p">,</span> <span class="n">resnames</span><span class="o">=</span><span class="n">openmmobject</span><span class="o">.</span><span class="n">resnames</span><span class="p">,</span>
    <span class="n">residlabels</span><span class="o">=</span><span class="n">openmmobject</span><span class="o">.</span><span class="n">resids</span><span class="p">,</span><span class="n">segmentlabels</span><span class="o">=</span><span class="n">openmmobject</span><span class="o">.</span><span class="n">segmentnames</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the residue information is provided via keyword arguments and the information taken from an ASH OpenMMTheory object, previously created.
The residue information is present in openmmobject as it was read from the CHARMM PSF-file.
Could also be done completely manually if desired.</p>
<ul class="simple">
<li><p>Example 3 (simple and recommended way):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">write_pdbfile</span><span class="p">(</span><span class="n">frag</span><span class="p">,</span> <span class="n">outputname</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">,</span><span class="n">openmmobject</span><span class="o">=</span><span class="n">openmmobject</span><span class="p">)</span>
</pre></div>
</div>
<p>Here an ASH openMMtheory object is provided to the function (defined like before) and the function will grab the information from it. It should then print a correct PDB-file with the residue, atom and segment information from the ASH OpenMM object. Note: all of this information is currently provided from the CHARMM PSF-file that is read into the ASH openMMtheory object
Note: the atomnames column differs from conventional CHARMM usage. Instead OpenMM atomnames are used. Should not matter too much.</p>
<p>Note: Only use PDB-files for basic visualization, when you want to be able to visualize the system and use the reside information etc in VMD to be able to select residues. PDB-file is not a good format for other things. We for example do not want to use it as a file format in general because the format only supports a limited number of decimal points for coordinates.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="thermochemistry.html" class="btn btn-neutral float-left" title="High-level Thermochemistry in ASH" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Ragnar Bjornsson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>