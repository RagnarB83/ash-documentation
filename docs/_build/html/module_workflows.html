

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Workflows &mdash; Ash 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Highlevel workflows" href="module_highlevel_workflows.html" />
    <link rel="prev" title="Benchmarking in ASH" href="module_benchmarking.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> Ash
          

          
            
            <img src="_static/ash-simple-logo-letterbig.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About.html">About ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-examples.html">Basic examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ash_program_philosophy.html">ASH Program Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate-input.html">Coordinates and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallelization.html">Parallelization in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-interfaces.html">QM Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="MM-interfaces.html">MM Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Jobtypes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="job-types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlepoint.html">Singlepoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_freq.html">Frequency calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_dynamics.html">Molecular dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="neb.html">Nudged Elastic Band Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="surfacescan.html">Surface Scans</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="module_QM-MM.html">QM/MM Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_benchmarking.html">Benchmarking in ASH</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reactionenergy">ReactionEnergy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thermochemprotocols">Thermochemprotocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calc-xyzfiles-run-calculations-on-a-collection-of-xyz-files">calc_xyzfiles: Run calculations on a collection of XYZ-files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#high-level-single-point-workflows">High-level single-point workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#confsampler-protocol-automatic-crest-dftopt-dlpno-ccsd-t-workflow">confsampler_protocol : Automatic Crest+DFTopt+DLPNO-CCSD(T) workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#counter-poise-correction-orca">Counter-poise correction (ORCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automatic-non-aufbau-calculator">Automatic non-Aufbau calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automatic-active-space-selection">Automatic active-space selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#redox-difference-density">Redox difference density</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="module_highlevel_workflows.html">Highlevel workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_molcrys.html">MOLCRYS: Automatic QM/MM for Molecular Crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_PES.html">PES: PhotoElectron/PhotoEmission Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_plotting.html">Plotting</a></li>
</ul>
<p class="caption"><span class="caption-text">Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ORCA-interface.html">ORCA interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="xTB-interface.html">xTB interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRCC-interface.html">MRCC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="CFour-interface.html">CFour interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="PySCF-interface.html">PySCF interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Psi4-interface.html">Psi4 interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="crest-interface.html">CREST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomeTRIC-interface.html">geomeTRIC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="knarr-interface.html">KNARR interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenMM-interface.html">OpenMM interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Explicit-solvation.html">Explicit solvation (small molecule)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-I.html">Metalloprotein tutorial I: Rubredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-II.html">Metalloprotein tutorial II: Ferredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-MM-protein.html">QM/MM on a protein</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows-examples.html">Workflow examples in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="Highlevel_CC_CBS_workflows.html">Tutorial: High-level CCSD(T)/CBS workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coordinate-tools.html">Coordinates and fragment tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ash</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Workflows</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/module_workflows.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflows">
<h1>Workflows<a class="headerlink" href="#workflows" title="Permalink to this headline">Â¶</a></h1>
<p>ASH includes a number of convenient built-in functionality to carry out multi-step workflows. See below.
See also <a class="reference internal" href="workflows-examples.html"><span class="doc">Workflow examples in ASH</span></a> for a tutorial on how you can build your own workflows.</p>
<div class="section" id="reactionenergy">
<h2>ReactionEnergy<a class="headerlink" href="#reactionenergy" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ReactionEnergy</span><span class="p">(</span><span class="n">list_of_energies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_of_fragments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;kcal/mol&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</pre></div>
</div>
<p><strong>ReactionEnergy</strong> options:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">list_of_energies</span></code></p></td>
<td><p>List of floats</p></td>
<td><p>None</p></td>
<td><p>List of energies as floats for reaction. Order must match stoichiometry list.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">stoichiometry</span></code></p></td>
<td><p>ASH Theory</p></td>
<td><p>list of integers</p></td>
<td><p>Integers that determine the stoichiometry of the reaction. Order must match list_of_energies or list_of_fragments.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">list_of_fragments</span></code></p></td>
<td><p>list of ASH Fragments</p></td>
<td><p>None</p></td>
<td><p>List of ASH fragments that must have a set energy attribute. Alternative to list_of_energies.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">unit</span></code></p></td>
<td><p>string</p></td>
<td><p>âkcal/molâ</p></td>
<td><p>String that indicates the final unit to convert reaction energy to. Options: âkcal/molâ, âeVâ, âkJ/molâ, âcm-1â.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reference</span></code></p></td>
<td><p>float</p></td>
<td><p>None</p></td>
<td><p>If set, this signifies the reference energy and ReactionEnergy will print both energy and error w.r.t. reference.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">silent</span></code></p></td>
<td><p>Boolean</p></td>
<td><p>False</p></td>
<td><p>Whether function prints to stdout (True) or not (False)</p></td>
</tr>
</tbody>
</table>
<p>The simple ReactionEnergy function is a convenient way to calculate the reaction energy for a reaction from a list of energies and the stoichiometry associated with the reaction.
The function prints to standard output the reaction energy (unless silent=True) and returns the relative energy converted into a unit of choice (default: kcal/mol).</p>
<p>Simple example for Haber-Bosch reaction:  N<sub>2</sub>  + 3H<sub>2</sub> â 2NH<sub>3</sub></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Haber-Bosch reaction: N2 + 3H2 =&gt; 2NH3</span>
<span class="n">N2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">diatomic</span><span class="o">=</span><span class="s2">&quot;N2&quot;</span><span class="p">,</span> <span class="n">diatomic_bondlength</span><span class="o">=</span><span class="mf">1.0975</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">diatomic</span><span class="o">=</span><span class="s2">&quot;H2&quot;</span><span class="p">,</span> <span class="n">diatomic_bondlength</span><span class="o">=</span><span class="mf">0.741</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">NH3</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;nh3.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">specieslist</span><span class="o">=</span><span class="p">[</span><span class="n">N2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">NH3</span><span class="p">]</span> <span class="c1">#An ordered list of ASH fragments.</span>
<span class="n">stoichiometry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#Using same order as specieslist.</span>
<span class="n">xtbcalc</span><span class="o">=</span><span class="n">xTBTheory</span><span class="p">(</span><span class="n">xtbmethod</span><span class="o">=</span><span class="s1">&#39;GFN1&#39;</span><span class="p">)</span> <span class="c1"># GFN1-xTB theory-level</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">Singlepoint_fragments</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">xtbcalc</span><span class="p">,</span> <span class="n">fragments</span><span class="o">=</span><span class="n">specieslist</span><span class="p">)</span> <span class="c1">#Calculating list of energies</span>

<span class="c1">#Calculating reaction-energy using list and stoichiometry</span>
<span class="n">reaction_energy</span><span class="p">,</span> <span class="n">unused</span> <span class="o">=</span> <span class="n">ReactionEnergy</span><span class="p">(</span><span class="n">stoichiometry</span><span class="o">=</span><span class="n">stoichiometry</span><span class="p">,</span> <span class="n">list_of_energies</span><span class="o">=</span><span class="n">energies</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;kcal/mol&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ÎE&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Reaction_energy(Î):  -136.6723479900558 kcal/mol
</pre></div>
</div>
<p>If there is an energy attribute associated with each fragment it is also possible to just provide ReactionEnergy with a list of the fragments involved.
This will only work if the energy attribute of the fragment has been defined. Some ASH functions will do this: <strong>Singlepoint</strong>, <strong>Singlepoint_fragments</strong>, <strong>geomeTRICOptimizer</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculating reaction-energy using list_of_fragments and stoichiometry</span>
<span class="n">specieslist</span><span class="o">=</span><span class="p">[</span><span class="n">N2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">NH3</span><span class="p">]</span>
<span class="n">reaction_energy</span><span class="p">,</span> <span class="n">unused</span> <span class="o">=</span> <span class="n">ReactionEnergy</span><span class="p">(</span><span class="n">stoichiometry</span><span class="o">=</span><span class="n">stoichiometry</span><span class="p">,</span> <span class="n">list_of_fragments</span><span class="o">=</span><span class="n">specieslist</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;kcal/mol&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ÎE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="thermochemprotocols">
<h2>Thermochemprotocols<a class="headerlink" href="#thermochemprotocols" title="Permalink to this headline">Â¶</a></h2>
<p>The <strong>thermochemprotocol_reaction</strong> and <strong>thermochemprotocol_single</strong> functions can be used to
perform a multi-step Opt+Freq+HL-single-point protocol on either a reaction or a single species.</p>
<p>The <strong>thermochemprotocol_reaction</strong> is used for chemical reactions by giving a list of ASH fragments, stoichiometry and theory levels.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">thermochemprotocol_reaction</span><span class="p">(</span><span class="n">fraglist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Opt_theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SP_theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orcadir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                   <span class="n">analyticHessian</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">pressure</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>while <strong>thermochemprotocol_single</strong> is used for a single fragment (<strong>thermochemprotocol_reaction</strong> calls <strong>thermochemprotocol_single</strong>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">thermochemprotocol_single</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Opt_theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SP_theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orcadir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                   <span class="n">analyticHessian</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">pressure</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</pre></div>
</div>
<p>The reaction is defined via a list of defined fragments and stoichiometry, a theory object for Opt+Freq steps is defined (Opt_theory)
and then a theory for the high-level single-point level is chosen (SP_theory). Can be any ASH Theory including ORCATheory, CC_CBS_Theory etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#</span>
<span class="n">numcores</span><span class="o">=</span><span class="mi">4</span>

<span class="n">N2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;n2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">H2</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;h2.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">NH3</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;nh3.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># List of species from reactant to product</span>
<span class="n">specieslist</span><span class="o">=</span><span class="p">[</span><span class="n">N2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">NH3</span><span class="p">]</span> <span class="c1">#Use same order as stoichiometry</span>
<span class="c1">#Equation stoichiometry : negative integer for reactant, positive integer for product</span>
<span class="c1"># Example: N2 + 3H2 -&gt; 2NH3  reaction should be:  [-1,-3,2]</span>
<span class="n">stoichiometry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#Use same order as specieslist</span>

<span class="c1">#Opt+Freq theory</span>
    <span class="n">B3LYP_opt</span><span class="o">=</span><span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! B3LYP D3BJ def2-TZVP def2/J tightscf&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>
    <span class="c1">#HL theory</span>
    <span class="n">DLPNO_CC_calc</span> <span class="o">=</span> <span class="n">CC_CBS_Theory</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">cardinals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">basisfamily</span><span class="o">=</span><span class="s2">&quot;def2&quot;</span><span class="p">,</span> <span class="n">DLPNO</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">pnosetting</span><span class="o">=</span><span class="s1">&#39;extrapolation&#39;</span><span class="p">,</span> <span class="n">pnoextrapolation</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

    <span class="c1">#Example: Thermochemistry protocol on the single N2 species</span>
<span class="n">thermochemprotocol_single</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">N2</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="o">=</span><span class="n">stoichiometry</span><span class="p">,</span>
                    <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span> <span class="n">Opt_theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SP_theory</span><span class="o">=</span><span class="n">DLPNO_CC_calc</span><span class="p">)</span>

<span class="c1">#Alternative: Thermochemistry protocol on the whole N2 + 3 H2 =&gt; 2 NH3 reaction</span>
<span class="n">thermochemprotocol_reaction</span><span class="p">(</span><span class="n">fraglist</span><span class="o">=</span><span class="n">specieslist</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="o">=</span><span class="n">stoichiometry</span><span class="p">,</span>
                    <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span> <span class="n">Opt_theory</span><span class="o">=</span><span class="n">B3LYP_opt</span><span class="p">,</span> <span class="n">SP_theory</span><span class="o">=</span><span class="n">DLPNO_CC_calc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="calc-xyzfiles-run-calculations-on-a-collection-of-xyz-files">
<h2>calc_xyzfiles: Run calculations on a collection of XYZ-files<a class="headerlink" href="#calc-xyzfiles-run-calculations-on-a-collection-of-xyz-files" title="Permalink to this headline">Â¶</a></h2>
<p><strong>calc_xyzfiles</strong> is similar to <strong>Singlepoint_fragments</strong> (<a class="reference internal" href="singlepoint.html"><span class="doc">Singlepoint</span></a>) but saves you the step of defining fragments manually if you already have XYZ-files collected in a directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_xyzfiles</span><span class="p">(</span><span class="n">xyzdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Freq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xtb_preopt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</pre></div>
</div>
<p>If you have a collection of XYZ-files that you wish to run calculations on (either single-point energy evalutation or geometry optimizations)
then this can be easily accomplished using the <strong>calc_xyzfiles</strong> function.
Charge and multiplicities for each XYZ-file need to be given in the description-line (2nd line) of each XYZ-file like this:</p>
<p>HCl.xyz example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2
0 1
H 0.0 0.0 0.0
Cl 0.0 0.0 1.3
</pre></div>
</div>
<p>Alternatively, if all molecules are e.g. neutral singlets then one can give charge=0, mult=1 keyword arguments to <strong>calc_xyzfiles()</strong></p>
<p>Example script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">24</span>
<span class="c1">#Directory of XYZ files. Can be full path or relative path (dir needs to be copied to scratch location in this case).</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;/home/bjornsson/FeCO4_N2/r2scan-opt/xyzfiles_temp&#39;</span>

<span class="c1">#Defining theory.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! r2SCAN-3c&quot;</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">cf maxiter 500 end&quot;</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">)</span>

<span class="c1">#Call calc_xyzfiles giving xyzdir and theory.</span>
<span class="c1">#Geometry optimizations for each XYZ-file can be requested via Opt=True (default False, i.e. singlepoint)</span>
<span class="n">calc_xyzfiles</span><span class="p">(</span><span class="n">xyzdir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">Opt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Same but with an xTB pre-optimization (requires xtb to be installed)</span>
<span class="c1">#calc_xyzfiles(xyzdir=dir, theory=ORCAcalc, Opt=True, xtb_preopt=True)</span>
</pre></div>
</div>
<p>The ASH script then runs through and gives a table at the end with the energies.
In the case of Opt=True, a geometry optimization is performed for each molecule at the chosen theory-level instead of a singlepoint calculations
and a final directory of XYZ-files with optimized coordinates is created.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>XYZ-file             Charge     Mult           Energy(Eh)
----------------------------------------------------------------------
no.xyz                     0       2      -129.8755914784
no_plus.xyz                1       1      -129.5232460574
h2.xyz                     0       1        -1.1693816161
n2.xyz                     0       1      -109.5070757384
hbr.xyz                    0       1     -2574.7361724856


XYZ-files with optimized coordinates can be found in: optimized_xyzfiles
</pre></div>
</div>
</div>
<div class="section" id="high-level-single-point-workflows">
<h2>High-level single-point workflows<a class="headerlink" href="#high-level-single-point-workflows" title="Permalink to this headline">Â¶</a></h2>
<p>See <a class="reference internal" href="module_highlevel_workflows.html"><span class="doc">Highlevel workflows</span></a></p>
</div>
<div class="section" id="confsampler-protocol-automatic-crest-dftopt-dlpno-ccsd-t-workflow">
<h2>confsampler_protocol : Automatic Crest+DFTopt+DLPNO-CCSD(T) workflow<a class="headerlink" href="#confsampler-protocol-automatic-crest-dftopt-dlpno-ccsd-t-workflow" title="Permalink to this headline">Â¶</a></h2>
<p>See <a class="reference internal" href="crest-interface.html"><span class="doc">CREST interface</span></a></p>
</div>
<div class="section" id="counter-poise-correction-orca">
<h2>Counter-poise correction (ORCA)<a class="headerlink" href="#counter-poise-correction-orca" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">counterpoise_calculation_ORCA</span><span class="p">(</span><span class="n">fragments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">monomer1_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">monomer2_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</pre></div>
</div>
<p>ASH can perform Boys-Bernardi counterpoise corrections (single-point energy level only) together with ORCA in a convenient way.
All that is required are geometries (previously optimized) for the AB dimer as well as monomers A and B respectively, a theory level definition and lists of atom indices that specify which atoms in the AB dimer belong to monomer A and B, respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Define ASH fragments for the A-B adduct (dimer) and monomers from XYZ-files</span>
<span class="c1">#Dimer: H2O...MeOH H-bonded complex</span>
<span class="n">dimer</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;h2o_meoh.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#H2O monomer</span>
<span class="n">h2o</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;h2o.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#MeOH monomer</span>
<span class="n">meoh</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;meoh.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#Combine fragments in a list</span>
<span class="n">all_fragments</span><span class="o">=</span><span class="p">[</span><span class="n">dimer</span><span class="p">,</span> <span class="n">h2o</span><span class="p">,</span> <span class="n">meoh</span><span class="p">]</span>

<span class="c1">#Define ORCA theory</span>
<span class="n">simple</span><span class="o">=</span><span class="s2">&quot; ! RI-MP2 def2-SVP def2-SVP/C RIJCOSX def2/J tightscf &quot;</span>
<span class="n">blocks</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%s</span><span class="s2">cf</span>
<span class="s2">maxiter 300</span>
<span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">orcacalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="n">simple</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">)</span>


<span class="c1">#Run counterpoise_calculation giving fragment-list, orcacalculation and atom-indices as input</span>
<span class="c1"># monomer1_indices and monomer2_indices specify which atoms in the dimer correspond to monomer1 and monomer2</span>
<span class="n">counterpoise_calculation_ORCA</span><span class="p">(</span><span class="n">fragments</span><span class="o">=</span><span class="n">all_fragments</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="n">orcacalc</span><span class="p">,</span> <span class="n">monomer1_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">monomer2_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
<p>The final output looks like :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                #######################################
                #                                     #
              #     COUNTERPOISE CORRECTION JOB     #
                #                                     #
                #######################################



 Boys-Bernardi counterpoise correction

monomer1_indices: [0, 1, 2]
monomer2_indices: [3, 4, 5, 6, 7, 8]

Monomer 1:
--------------------
Defined coordinates (Ã):
   O  -0.52532979   -0.05097108   -0.31451686
   H  -0.94200663    0.74790163    0.01125282
   H   0.40369652    0.05978598   -0.07356837
Monomer 1 indices in dimer: [0, 1, 2]

Monomer 2:
--------------------
Defined coordinates (Ã):
   O   2.31663329    0.04550085    0.07185839
   H   2.68461611   -0.52657655    0.74938672
   C   2.78163836   -0.42612907   -1.19030072
   H   2.35082127    0.22496462   -1.94341475
   H   3.86760205   -0.37533621   -1.26461265
   H   2.45329574   -1.44599856   -1.38938136
Monomer 2 indices in dimer: [3, 4, 5, 6, 7, 8]

Dimer:
--------------------
0   O -0.525329794 -0.050971084 -0.314516861   Monomer1
1   H -0.942006633 0.747901631 0.011252816   Monomer1
2   H 0.403696525 0.059785981 -0.073568368   Monomer1
3   O 2.316633291 0.045500849 0.071858389   Monomer2
4   H 2.684616115 -0.526576554 0.749386716   Monomer2
5   C 2.781638362 -0.426129067 -1.190300721   Monomer2
6   H 2.350821267 0.224964624 -1.943414753   Monomer2
7   H 3.867602049 -0.375336206 -1.264612649   Monomer2
8   H 2.453295744 -1.445998564 -1.389381355   Monomer2


----LOTS OF CALCULATION OUTPUT---

COUNTERPOISE CORRECTION RESULTS
==================================================

Monomer 1 energy: -76.162192724532 Eh
Monomer 2 energy: -115.290878785879 Eh
Sum of monomers energy: -191.453071510411 Eh
Dimer energy: -191.465349252819 Eh

Monomer 1 at dimer geometry: -115.290878793717 Eh
Monomer 2 at dimer geometry: -76.162192727048 Eh
Sum of monomers at dimer geometry energy: -191.45307152076498 Eh

Monomer 1 at dimer geometry with dimer basis: -115.29491810198 Eh
Monomer 2 at dimer geometry with dimer basis: -76.163483336908 Eh
Sum of monomers at dimer geometry with dimer basis: -191.45840143888802 Eh
counterpoise_corr: 3.344574118169517 kcal/mol

Uncorrected interaction energy: -7.704399681128008 kcal/mol
Corrected interaction energy: -4.359825562958491 kcal/mol
</pre></div>
</div>
</div>
<div class="section" id="automatic-non-aufbau-calculator">
<h2>Automatic non-Aufbau calculator<a class="headerlink" href="#automatic-non-aufbau-calculator" title="Permalink to this headline">Â¶</a></h2>
<p>Excited SCF configurations can be tricky to converge to without falling back to the ground-state.
While various different algorithms have recently been suggested in the literature to help locating such excited SCF configurations, often the methods are  only available in specific QM codes.
The <a class="reference external" href="https://doi.org/10.1021/acs.jctc.0c00502">STEP</a> algorithm by Carter-Fenk and Herbert is a much simpler algorithm and can be used with any QM program with level-shifting implemented (a common SCF convergence aid).
The idea is simply to choose to change the MO occupation as desired (e.g. swap the HOMO and LUMO orbitals) and then choose a specific levelshift and hopefully converge to the desired SCF configuration.
The levelshift is chosen based on the occupied-virtual orbital-energy gap together with an extra parameter, epsilon (0.1 by default).</p>
<p>ASH allows one to utilize the STEP algorithm in a convenient way together with ORCA (only QM-program supported so far) using the <strong>AutoNonAufbau</strong> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AutoNonAufbau</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_occ_orbs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_virt_orbs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">spinset</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stability_analysis_GS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">TDDFT</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">manual_levelshift</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</pre></div>
</div>
<p><strong>AutoNonAufbau</strong> options:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fragment</span></code></p></td>
<td><p>ASH Fragment</p></td>
<td><p>None</p></td>
<td><p>ASH Fragment object.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">theory</span></code></p></td>
<td><p>ASH Theory</p></td>
<td><p>None</p></td>
<td><p>An ASH theory level. Currently only ORCATheory is supported.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">num_occ_orbs</span></code></p></td>
<td><p>integer</p></td>
<td><p>1</p></td>
<td><p>Number of occupied orbitals to include the in orbital rotation procedure. A value of 3 would include the HOMO, HOMO-1 and HOMO-2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">num_virt_orbs</span></code></p></td>
<td><p>integer</p></td>
<td><p>3</p></td>
<td><p>Number of virtual orbitals to include the in orbital rotation procedure. A value of 3 would include the LUMO, LUMO+1 and LUMO+2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spinset</span></code></p></td>
<td><p>list</p></td>
<td><p>[0]</p></td>
<td><p>What spin manifold to use. Alpha: [0] or  Beta: [1] or Both: [0,1]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TDDFT</span></code></p></td>
<td><p>Boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to do TDDFT on the ground-state in order to select orbitals to rotate. Experimental feature</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code></p></td>
<td><p>float</p></td>
<td><p>0.1</p></td>
<td><p>The value of the epsilon parameter in the STEP algorithm.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">maxiter</span></code></p></td>
<td><p>integer</p></td>
<td><p>500</p></td>
<td><p>Maximum number of ORCA SCF iterations.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">manual_levelshift</span></code></p></td>
<td><p>float</p></td>
<td><p>None</p></td>
<td><p>Manual levelshift instead of the automatic levelshift (based on the gap and epsilon parameter)</p></td>
</tr>
</tbody>
</table>
<p><strong>How to use:</strong></p>
<p>One reads in an ASH fragment, an ORCATheory object and optionally specifies how many occupied and virtual orbitals, what spin manifold to use etc.
ASH will then tell ORCA to calculate the ground-state SCF in a first step.
ASH will then go through all possible SCF configurations that involve the highest-energy occupied MOs and the lowest-energy virtual MOs based on the user selection,
rotate the respective occupied and virtual orbital pair (e.g. the HOMO and LUMO+1), apply a levelshift based on the orbital-energy gap and the epsilon parameter (0.1 Eh by default)
and then attempt to converge the SCF for each possible guess configuration.</p>
<p>Example: Finding excited SCF states of the water molecule.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#</span>
<span class="n">frag</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">databasefile</span><span class="o">=</span><span class="s2">&quot;h2o.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">orcacalc</span><span class="o">=</span><span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! UHF def2-QZVPPD usesym&quot;</span><span class="p">)</span>

<span class="n">AutoNonAufbau</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">orcacalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">frag</span><span class="p">,</span> <span class="n">num_occ_orbs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_virt_orbs</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">spinset</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                                        #########################
                                        #                       #
                                        #     AutoNonAufbau     #
                                        #                       #
                                        #########################


Spin orbital sets to choose: [0]
Number of occupied orbitals allowed in MO swap: 2
Number of virtual orbitals allowed in MO swap: 16
Total number of states: 32
TDDFT: False
stability_analysis_GS: False
Epsilon: 0.1
manual_levelshift: None
Cleaning up old ORCA files
Now doing initial state SCF calculation
...
Energy:  -76.06701160263
...
==========================================================================================
Now running excited state SCF no. 0 with multiplicity: 1 and spinset 0
==========================================================================================
Simple MO selection scheme
homo_lumo_gap: -0.5747076804099635
Will rotate orbital 4 (HOMO) and orbital 5
lshift: 0.6747076804099634
Now doing SCF calculation with rotated MOs and levelshift
...
Energy:  -75.835914096332
GS/ES state energy gap: 6.29 eV
Found something different than ground state
Converged SCF energy higher than ground-state SCF. Found new excited state SCF solution !

==========================================================================================
Now running excited state SCF no. 1 with multiplicity: 1 and spinset 0
==========================================================================================
Simple MO selection scheme
homo_lumo_gap: -0.58996231689521
Will rotate orbital 4 (HOMO) and orbital 6
lshift: 0.6899623168952099
Now doing SCF calculation with rotated MOs and levelshift
...
Energy:  -75.771691604422
GS/ES state energy gap: 8.04 eV
Found something different than ground state
Converged SCF energy higher than ground-state SCF. Found new excited state SCF solution !
==========================================================================================
Now running excited state SCF no. 2 with multiplicity: 1 and spinset 0
==========================================================================================
Simple MO selection scheme
homo_lumo_gap: -0.6157346044574922
Will rotate orbital 4 (HOMO) and orbital 7
lshift: 0.7157346044574922
Now doing SCF calculation with rotated MOs and levelshift
...
Energy:  -76.067008807825
GS/ES state energy gap: 0.00 eV
GS/ES state energy gap smaller than 0.04 eV. Presumably found the original SCF again.
</pre></div>
</div>
<p>The final output will print a list of all the states found.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Ground-state SCF energy: -76.06701160263 Eh
-----
Excited state index: 0
Spin multiplicity: 1
Excited-state SCF energy 0: -75.835914096332 Eh
Excited-state SCF transition energy: 6.29 eV
Excited-state SCF orbital rotation: Occ:[4] Virt:[5]
Rotation in spin manifold:  [0]
Excited-state SCF HOMO-LUMO gap: -0.5747076804099635 Eh (-15.638599999999999) eV:
Excited-state SCF Levelshift chosen: 0.6747076804099634
-----
Excited state index: 1
Spin multiplicity: 1
Excited-state SCF energy 1: -75.771691604422 Eh
Excited-state SCF transition energy: 8.04 eV
Excited-state SCF orbital rotation: Occ:[4] Virt:[6]
Rotation in spin manifold:  [0]
Excited-state SCF HOMO-LUMO gap: -0.58996231689521 Eh (-16.0537) eV:
Excited-state SCF Levelshift chosen: 0.6899623168952099
-----
Excited state index: 2
Spin multiplicity: 1
Excited-state SCF energy 2: -76.067008807825 Eh
Excited-state SCF transition energy: 0.00 eV
Excited-state SCF orbital rotation: Occ:[4] Virt:[7]
Rotation in spin manifold:  [0]
Excited-state SCF HOMO-LUMO gap: -0.6157346044574922 Eh (-16.755) eV:
Excited-state SCF Levelshift chosen: 0.7157346044574922
</pre></div>
</div>
<p>ORCA outputfiles and GBW files for each state is kept and can be inspected or used for future calculations.</p>
<ul class="simple">
<li><p>orca_GS.out</p></li>
<li><p>orca_GS.gbw</p></li>
<li><p>orcaES_SCF0_mult1_spinset0.out</p></li>
<li><p>orcaES_SCF0_mult1_spinset0.gbw</p></li>
<li><p>orcaES_SCF1_mult1_spinset0.out</p></li>
<li><p>orcaES_SCF1_mult1_spinset0.gbw</p></li>
<li><p>orcaES_SCF2_mult1_spinset0.out</p></li>
<li><p>orcaES_SCF2_mult1_spinset0.gbw</p></li>
</ul>
</div>
<div class="section" id="automatic-active-space-selection">
<h2>Automatic active-space selection<a class="headerlink" href="#automatic-active-space-selection" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">auto_active_space</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orcadir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;def2-SVP&quot;</span><span class="p">,</span> <span class="n">scalar_rel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">initial_orbitals</span><span class="o">=</span><span class="s1">&#39;MP2&#39;</span><span class="p">,</span> <span class="n">functional</span><span class="o">=</span><span class="s1">&#39;TPSS&#39;</span><span class="p">,</span> <span class="n">smeartemp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">tgen</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">selection_thresholds</span><span class="o">=</span><span class="p">[</span><span class="mf">1.999</span><span class="p">,</span><span class="mf">0.001</span><span class="p">],</span>
<span class="n">numcores</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</pre></div>
</div>
<p>Workflow to guess a good active space for CASSCF calculation based on a 2-step procedure:
1. Calculate MP2-natural orbitals (alternative Fractional occupation DFT orbitals)
2. ICE-CI on top of MP2-natural orbitals using a large active-space but with small tgen threshold</p>
<p>Example on ozone:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">fragstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       -2.219508975      0.000000000     -0.605320629</span>
<span class="s2">O       -1.305999766     -0.913250049     -0.557466332</span>
<span class="s2">O       -2.829559171      0.140210894     -1.736132689</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">fragment</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">fragstrin</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">activespace_dictionary</span> <span class="o">=</span> <span class="n">auto_active_space</span><span class="p">(</span><span class="n">fragment</span><span class="o">=</span><span class="n">fragment</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;def2-TZVP&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">initial_orbitals</span><span class="o">=</span><span class="s1">&#39;MP2&#39;</span><span class="p">,</span> <span class="n">tgen</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1">#Returns dictionary with various active_spaces based on thresholds</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ICE-CI step done
Note: New natural orbitals from ICE-CI density matrix formed!

Wavefunction size:
Tgen: 1.0
Tvar: 1e-07
Orbital space of CAS(18,37) used for ICE-CI step
Num generator CFGs: 4370
Num CFGS after S+D: 4370

Table of natural occupation numbers

Orbital   MP2natorbs ICE-nat-occ
----------------------------------------
0            2.0000    2.0000
1            2.0000    2.0000
2            2.0000    2.0000
3            1.9859    1.9898
4            1.9809    1.9869
5            1.9747    1.9836
6            1.9637    1.9791
7            1.9607    1.9787
8            1.9360    1.9665
9            1.9223    1.9631
10           1.9197    1.9603
11           1.8522    1.9371
12           0.1868    0.0779
13           0.0680    0.0349
14           0.0612    0.0318
15           0.0241    0.0122
16           0.0171    0.0093
17           0.0146    0.0081
18           0.0117    0.0076
19           0.0106    0.0067
20           0.0105    0.0064
...

Recommended active spaces based on ICE-CI natural occupations:
Minimal (1.95,0.05): CAS(2,2)
Medium1 (1.98,0.02): CAS(12,9)
Medium2 (1.985,0.015): CAS(14,10)
Medium3 (1.99,0.01): CAS(18,13)
Medium4 (1.992,0.008): CAS(18,15)
Large (1.995,0.005): CAS(18,19)
Orbital file to use for future calculations: orca.gbw
Note: orbitals are new natural orbitals formed from the ICE-CI density matrix
</pre></div>
</div>
</div>
<div class="section" id="redox-difference-density">
<h2>Redox difference density<a class="headerlink" href="#redox-difference-density" title="Permalink to this headline">Â¶</a></h2>
<a class="reference internal image-reference" href="_images/cocene-redox-diffdens-300.png"><img alt="_images/cocene-redox-diffdens-300.png" class="align-center" src="_images/cocene-redox-diffdens-300.png" style="width: 700px;" /></a>
<p>To understand the nature of a redox process it can be useful to calculate and visualize the density difference between the two redox species.
This can only cleanly be done for a vertical redox process.
First one requires Cube files of the electron density for both species that should have the same geometry and same number of grid points (and ideally quite fine).
Then one can call the built-in ASH function: <strong>read_cube</strong> and <strong>write_cube_diff</strong>  to output the density difference as a Cube file.
The calculations, Cube-file creation and the density-difference can be done in a single script as shown below if using ORCA (orca_plot used to generate the Cubefiles.)</p>
<p><strong>Example: Vertical ionization of Cobaltocene</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">string</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Co       6.344947000     -1.560817000      5.954256000</span>
<span class="s2">C        6.026452000     -0.546182000      7.802276000</span>
<span class="s2">C        5.793563000     -1.965872000      7.908267000</span>
<span class="s2">C        7.027412000     -2.657637000      7.660083000</span>
<span class="s2">C        7.976024000     -1.681400000      7.254253000</span>
<span class="s2">C        7.360141000     -0.371346000      7.359546000</span>
<span class="s2">H        5.287260000      0.234934000      7.955977000</span>
<span class="s2">H        4.853677000     -2.430623000      8.196105000</span>
<span class="s2">H        7.174908000     -3.733662000      7.680248000</span>
<span class="s2">H        7.845323000      0.573837000      7.130600000</span>
<span class="s2">C        7.003675000     -1.909758000      4.002507000</span>
<span class="s2">C        6.025582000     -2.892708000      4.310293000</span>
<span class="s2">C        4.831240000     -2.191536000      4.690416000</span>
<span class="s2">C        5.029751000     -0.780020000      4.468693000</span>
<span class="s2">C        6.380790000     -0.601338000      4.083942000</span>
<span class="s2">H        8.038293000     -2.097559000      3.727053000</span>
<span class="s2">H        6.179063000     -3.967316000      4.350882000</span>
<span class="s2">H        3.905308000     -2.652860000      5.025216000</span>
<span class="s2">H        6.875603000      0.346060000      3.887076000</span>
<span class="s2">H        4.297348000      0.002948000      4.644348000</span>
<span class="s2">H        8.999375000     -1.871686000      6.940915000</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Defining fragment for redox reaction</span>
<span class="n">Co_neut</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Co_ox</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cocene_&quot;</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
<span class="c1">#Defining QM theory as ORCA here</span>
<span class="n">qm</span><span class="o">=</span><span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="s2">&quot;! BP86 def2-SVP tightscf notrah&quot;</span><span class="p">)</span>

<span class="c1">#Run neutral species with ORCA</span>
<span class="n">e_neut</span><span class="o">=</span><span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">Co_neut</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.gbw&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">+</span><span class="s2">&quot;neut.gbw&quot;</span><span class="p">)</span> <span class="c1"># Copy GBW file</span>
<span class="c1">#Run orca_plot to request electron density creation from ORCA gbw file</span>
<span class="n">run_orca_plot</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;neut.gbw&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="n">gridvalue</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="c1">#Run oxidized species with ORCA</span>
<span class="n">e_ox</span><span class="o">=</span><span class="n">Singlepoint</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">Co_ox</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.gbw&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">+</span><span class="s2">&quot;ox.gbw&quot;</span><span class="p">)</span>  <span class="c1"># Copy GBW file</span>
<span class="c1">#Run orca_plot to request electron density creation from ORCA gbw file</span>
<span class="n">run_orca_plot</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;ox.gbw&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="n">gridvalue</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="c1">#Read Cubefiles from disk.</span>
<span class="n">neut_cube_data</span> <span class="o">=</span> <span class="n">functions</span><span class="o">.</span><span class="n">functions_elstructure</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;neut.eldens.cube&quot;</span><span class="p">)</span>
<span class="n">ox_cube_data</span> <span class="o">=</span> <span class="n">functions</span><span class="o">.</span><span class="n">functions_elstructure</span><span class="o">.</span><span class="n">read_cube</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;ox.eldens.cube&quot;</span><span class="p">)</span>
<span class="c1">#Write out difference density as a Cubefile</span>
<span class="n">functions</span><span class="o">.</span><span class="n">functions_elstructure</span><span class="o">.</span><span class="n">write_cube_diff</span><span class="p">(</span><span class="n">neut_cube_data</span><span class="p">,</span> <span class="n">ox_cube_data</span><span class="p">,</span> <span class="n">label</span><span class="o">+</span><span class="s2">&quot;diffence_density.cube&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The script will output the files Cocene_neut.eldens.cube and Cocene_ox.eldens.cube that are here generated by orca_plot.
The file Cocene_diffence_density.cube is generated by <strong>write_cube_diff</strong>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="module_highlevel_workflows.html" class="btn btn-neutral float-right" title="Highlevel workflows" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="module_benchmarking.html" class="btn btn-neutral float-left" title="Benchmarking in ASH" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Ragnar Bjornsson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>