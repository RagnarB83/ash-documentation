

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>PES: PhotoElectron/PhotoEmission Spectrum &mdash; Ash 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Plotting" href="module_plotting.html" />
    <link rel="prev" title="MOLCRYS: Automatic QM/MM for Molecular Crystals" href="module_molcrys.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> Ash
          

          
            
            <img src="_static/ash-simple-logo-letterbig.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About.html">About ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-examples.html">Basic examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ash_program_philosophy.html">ASH Program Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate-input.html">Coordinates and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallelization.html">Parallelization in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-interfaces.html">QM Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="MM-interfaces.html">MM Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Jobtypes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="job-types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlepoint.html">Singlepoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_freq.html">Frequency calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_dynamics.html">Molecular dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="neb.html">Nudged Elastic Band Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="surfacescan.html">Surface Scans</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="module_QM-MM.html">QM/MM Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_Hybrid_Theory.html">Hybrid Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_benchmarking.html">Benchmarking in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_highlevel_workflows.html">Highlevel workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_molcrys.html">MOLCRYS: Automatic QM/MM for Molecular Crystals</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PES: PhotoElectron/PhotoEmission Spectrum</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#photoelectronspectrum-function">PhotoElectronSpectrum function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-spectrum">Plot spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-tddft-on-h2o">Example: TDDFT on H<sub>2</sub>O</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-fes2-tddft-vs-ip-eom-ccsd-vs-casscf-vs-mrci-q">Example: FeS<sub>2</sub> <sup>-</sup> : TDDFT vs. IP-EOM-CCSD vs. CASSCF vs. MRCI+Q</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="module_plotting.html">Plotting</a></li>
</ul>
<p class="caption"><span class="caption-text">Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ORCA-interface.html">ORCA interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="xTB-interface.html">xTB interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRCC-interface.html">MRCC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="CFour-interface.html">CFour interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dalton-interface.html">Dalton interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="PySCF-interface.html">PySCF interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Psi4-interface.html">Psi4 interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="crest-interface.html">CREST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomeTRIC-interface.html">geomeTRIC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="knarr-interface.html">KNARR interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenMM-interface.html">OpenMM interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Explicit-solvation.html">Explicit solvation (small molecule)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-I.html">Metalloprotein tutorial I: Rubredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metalloprotein-II.html">Metalloprotein tutorial II: Ferredoxin</a></li>
<li class="toctree-l1"><a class="reference internal" href="QM-MM-protein.html">QM/MM on a protein</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows-examples.html">Workflow examples in ASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="Highlevel_CC_CBS_workflows.html">Tutorial: High-level CCSD(T)/CBS workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coordinate-tools.html">Coordinates and fragment tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ash</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>PES: PhotoElectron/PhotoEmission Spectrum</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/module_PES.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pes-photoelectron-photoemission-spectrum">
<h1>PES: PhotoElectron/PhotoEmission Spectrum<a class="headerlink" href="#pes-photoelectron-photoemission-spectrum" title="Permalink to this headline">Â¶</a></h1>
<p>Workflow to calculate photoelectron/photoemission spectra of molecules using either TDDFT, CASSCF, MRCI+Q or EOM-IP-CCSD state energies combined
with a Dyson-orbital norm approach for intensities.</p>
<ul class="simple">
<li><p>The TDDFT workflow combines an SCF-calculation of the initial state and an SCF+TDDFT calculation of the first ionized state (of each ionized-state multiplicity) to get the full ionization energy spectrum for each spin multiplicity. Dyson orbital norms are then calculated as approximate intensities for both SCF-type and TDDFT-type states by parsing theORCA TDDFT output files.</p></li>
<li><p>The CASSCF workflow performs a CASSCF calculation of the initial state and the uses the initial-state orbitals in a CAS-CI calculation of the ionized states of both spin multiplicities. Both regular CASSCF and ICE-CASSCF in ORCA is possible.</p></li>
<li><p>The MRCI+Q workflow is similar to the CASSCF workflow but on top of the CASSCF orbital optimization of the initial state an MRCI+Q calculation is performed and for the ionized state the initial-state orbitals are used as before. For CASSCF and MRCI+Q, determinant-printing of the wavefunction is requested (printed in the output) which is parsed by the code and fed to the Wfoverlap program.</p></li>
<li><p>The IP-EOM-CCSD approach calculates the ionized states directly via the IP-EOM approach from the CCSD wavefunction of the initial state. Approximate Dyson norms are used here, i.e. the dominant coefficient of the singles eigenvector.</p></li>
</ul>
<p>Notes:</p>
<ul class="simple">
<li><p>ORCA is the only supported QM-code for now.</p></li>
<li><p>Requires <a class="reference external" href="https://sharc-md.org/?page_id=309">Wfoverlap</a> program to calculate Dyson orbital norms via determinant-based wavefunctions.</p></li>
<li><p>Plotting option requires installation of Matplotlib.</p></li>
</ul>
<p>Potential issues: Wfoverlap binary requires libblas.so.3 and liblapack.so.3 binaries. Make sure a directory containing these
libraries is in your LD_LIBRARY_PATH.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/pes-mncl2.png"><img alt="alternate text" src="_images/pes-mncl2.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Figure 1. PES-spectrum via MRCI+Q using ASH and ORCA</span><a class="headerlink" href="#id1" title="Permalink to this image">Â¶</a></p>
</div>
<div class="section" id="photoelectronspectrum-function">
<h2>PhotoElectronSpectrum function<a class="headerlink" href="#photoelectronspectrum-function" title="Permalink to this headline">Â¶</a></h2>
<p>The PES.PhotoElectronSpectrum function takes the following keyword arguments:</p>
<p><strong>Necessary:</strong></p>
<ul class="simple">
<li><p>theory: An ASH Theory object (only ORCATheory supported at the moment)</p></li>
<li><p>fragment: An ASH fragment object</p></li>
<li><p>InitialState_charge : integer</p></li>
<li><p>InitialState_mult : integer</p></li>
<li><p>Ionizedstate_charge: integer</p></li>
<li><p>Ionizedstate_mult: integer or list of integers, e.g. [5,7]</p></li>
<li><p>path_wfoverlap: string</p></li>
<li><p>numionstates : integer (default: 50)</p></li>
</ul>
<p><strong>Optional:</strong></p>
<ul class="simple">
<li><p>memory: integer (in MB), (memory used by Wfoverlap, default: 40000)</p></li>
<li><p>numcores: integer (number of cores used in WFOverlap, default: 1) Note: ORCA parallelization is handled by ORCA object.</p></li>
<li><p>noDyson : Boolean(True/False), (whether to skip Dyson-norm computation, default: False)</p></li>
<li><p>tda : Boolean (default: True)</p></li>
<li><p>brokensym: Boolean (default: False)</p></li>
<li><p>HSmult : integer (for brokensym feature, default: None)</p></li>
<li><p>atomstoflip : list of integers (for brokensym feature, default: None)</p></li>
<li><p>initialorbitalfiles : list of filename-strings (for reading in orbital guesses, default : None)</p></li>
<li><p>Densities: String-option (âSCFâ, âAllâ, âNoneâ). For calculating SCF densities, SCF+TDDFT densities or none.</p></li>
<li><p>densgridvalue : integer (gridpoints for densities, default: 100)</p></li>
<li><p>CAS : Boolean (True/False), (CASSCF-PES option, default: False)</p></li>
<li><p>CAS_Initial : list of active space numbers (electrons,orbitals), (e.g. [3,2] for 3-el/2orb active space, default : None)</p></li>
<li><p>CAS_Final : list of active space numbers (electrons,orbitals), (e.g. [3,2] for 3-el/2orb active space, default : None)</p></li>
<li><p>CASCI : Boolean(True/False), (whether to skip CASSCF-orbital optimization for Ionized states, default: False)</p></li>
<li><p>MRCI : Boolean (True/False), (MRCI-PES option, default: False)</p></li>
<li><p>MRCI_Initial : list of active space numbers (electrons,orbitals), (e.g. [3,2] for 3-el/2orb active space, default : None)</p></li>
<li><p>MRCI_Final : list of active space numbers (electrons,orbitals), (e.g. [3,2] for 3-el/2orb active space, default : None)</p></li>
<li><p>MRCI_CASCI_Final: Boolean (True/False), (whether to do CAS-CI for ionized states instead of CASSCF, default: True)</p></li>
<li><p>tprintwfvalue : Float (threshold for determinant printing, default: 1e-6)</p></li>
<li><p>EOM:  Boolean (True/False), (IP-EOM-CCSD-PES option, default: False)</p></li>
</ul>
<p>By default a TDDFT-TDA approach is used and a functional keyword should then be provided, a basis set and any other SCF-related settings.
For a CASSCF PES, use CAS=True, for MRCI PES, use MRCI=True and set the respective additional arguments (CAS_Initial,CAS_Final  or MRCI_Initial/MRCI_Final).
Also provide a basis set in the ORCA object.
For IP-EOM-CCSD, use EOM=True and provide a basis set keyword in the ORCA object.</p>
<p>The output of the function are lists of IPs, Dyson-norms. MO energies are also printed.</p>
<p>To make sure that the SCF calculations (in TDDFT or IP-EOM-CCSD jobs) or CASSCF (in CASSCF and MRCI+Q jobs ) calculations converge to the desired initial state or final state one can:
- request a stability analysis. Add %scf stabperform true end in the ORCA-object.
- read in previously converged orbital files for each state: initialorbitalfiles keyword.
- read in a previously converged orbital file. Provide a âorca-input.gbwâ file in the same dir as the inputfile (and make sure it gets copied to scratch).
- For CASSCF: switch to orbstep DIIS and switchstep DIIS to preserve the chosen active space. See FeS2 example below.</p>
<p><strong>TDDFT</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">mncl2</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                          <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                            <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>CASSCF</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">mncl2</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                          <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                          <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">CAS_Initial</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">CAS_Final</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>
                            <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>MRCI+Q</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">mncl2</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                          <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                          <span class="n">MRCI</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MRCI_Initial</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">MRCI_Final</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>
                            <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>IP-EOM-CCSD</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">mncl2</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                          <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="n">EOM</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-spectrum">
<h2>Plot spectrum<a class="headerlink" href="#plot-spectrum" title="Permalink to this headline">Â¶</a></h2>
<p>To plot the spectrum one can use the plotting.plot_Spectrum function (see <a class="reference internal" href="module_plotting.html"><span class="doc">Plotting</span></a>)</p>
<p>Just provide as x and y values the list of ionization energies (in eVs) and the list of dysonnorms and the function will create broadened
spectra. Typically you would run this in th same job as the PES.PhotoElectronSpectrum function, using the respective output as input.</p>
<p>The ionization energy range can be controlled (via the range keyword, provide a list of start and end values),
number of points and broadening factor (eV) and the name of the plot. A PNG image file of the broadened spectrum and a stick-spectrum is created as well
as files contained broadened spectrum (.dat files) and stick-spectrum (.stk files).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Plotting TDDFT-IP spectrum with Dysonnorm-intensities as well as MO-spectrum.</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_B3LYP&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
    <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>The plot_Spectrum function can be run on its own or as part of the PhotoElectronSpectrum job.
If a previous PES.PhotoElectronSpectrum job is available, the respective Results file (âPES-Results.txtâ) can be conveniently read in like below.
Make sure the PES-Results.txt is available in the same directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Read in old results</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span><span class="p">,</span> <span class="n">mos_alpha</span><span class="p">,</span> <span class="n">mos_beta</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">Read_old_results</span><span class="p">()</span>

<span class="c1">#Plotting TDDFT-IP spectrum with Dysonnorm-intensities as well as MO-spectrum.</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_TPSSh&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
    <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: The plotting part (requires Matplotlib)  that creates the final image file can be turned off by setting matplotlib=False</p>
</div>
<div class="section" id="example-tddft-on-h2o">
<h2>Example: TDDFT on H<sub>2</sub>O<a class="headerlink" href="#example-tddft-on-h2o" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">PES</span>

<span class="n">h2ostring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O        0.222646668      0.000000000     -0.752205128</span>
<span class="s2">H        0.222646668      0.759337000     -0.156162128</span>
<span class="s2">H        0.222646668     -0.759337000     -0.156162128</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">h2o</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">coordsstring</span><span class="o">=</span><span class="n">h2ostring</span><span class="p">)</span>

<span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! B3LYP def2-SVP Grid5 Finalgrid6 tightscf&quot;</span>
<span class="n">blocks</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%s</span><span class="s2">cf</span>
<span class="s2">maxiter 200</span>
<span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Define ORCA theory.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms and MO-spectrum</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">h2o</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">numionstates</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                            <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>

<span class="c1">#Plotting TDDFT-IP spectrum with Dysonnorm-intensities as well as MO-spectrum.</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_B3LYP&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
    <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-fes2-tddft-vs-ip-eom-ccsd-vs-casscf-vs-mrci-q">
<h2>Example: FeS<sub>2</sub> <sup>-</sup> : TDDFT vs. IP-EOM-CCSD vs. CASSCF vs. MRCI+Q<a class="headerlink" href="#example-fes2-tddft-vs-ip-eom-ccsd-vs-casscf-vs-mrci-q" title="Permalink to this headline">Â¶</a></h2>
<p>This example of the FeS<sub>2</sub> <sup>-</sup>- anion accounts for multiple Finalstate spin-multiplicities as we go from:</p>
<p>Initial state: FeS<sub>2</sub> <sup>-</sup>- S=5/2 to  Final state: FeS<sub>2</sub>S=2 and S=3</p>
<p><strong>TDDFT example</strong>
Here we show how results with multiple functionals can be obtained at the same time. SCF convergence aids and grid settings can be provided.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">PES</span>

<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;FeS2-tpssh-opt.xyz&quot;</span><span class="p">)</span>

<span class="n">functionals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BP86&#39;</span><span class="p">,</span> <span class="s1">&#39;BLYP&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSS&#39;</span><span class="p">,</span> <span class="s1">&#39;TPSSh&#39;</span><span class="p">,</span> <span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span> <span class="s1">&#39;PBE0&#39;</span><span class="p">,</span> <span class="s1">&#39;BHLYP&#39;</span><span class="p">,</span> <span class="s1">&#39;CAM-B3LYP&#39;</span><span class="p">,</span> <span class="s1">&#39;wB97M-D3BJ&#39;</span><span class="p">,</span> <span class="s1">&#39;HF&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">functional</span> <span class="ow">in</span> <span class="n">functionals</span><span class="p">:</span>
    <span class="n">joblabel</span><span class="o">=</span><span class="s2">&quot;FeS2min-&quot;</span><span class="o">+</span><span class="n">functional</span>
    <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! def2-TZVP RIJCOSX def2/J GridX5 Grid5 Finalgrid6 tightscf slowconv &quot;</span> <span class="o">+</span> <span class="n">functional</span>
    <span class="n">blocks</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    </span><span class="si">%s</span><span class="s2">cf</span>
<span class="s2">    maxiter 1500</span>
<span class="s2">    directresetfreq 1</span>
<span class="s2">    diismaxeq 20</span>
<span class="s2">    end</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1">#Define ORCA theory.</span>
    <span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms and MO-spectrum</span>
    <span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                          <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span>
                            <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>

    <span class="c1">#Plotting TDDFT-IP spectrum with Dysonnorm-intensities as well as MO-spectrum.</span>
    <span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_&#39;</span><span class="o">+</span><span class="n">functional</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
        <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="n">PES</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A table is printed out:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-------------------------------------------------------------------------
FINAL RESULTS
-------------------------------------------------------------------------
Initial state:
State no.    Mult     TotalE (Eh)      State-type
    0       6    -2060.29687303000      SCF

Final ionized states:
State no.    Mult     TotalE (Eh)      IE (eV)  Dyson-norm State-type TDDFT Exc.E. (eV)
    0       5    -2060.17646751000      3.276    0.94885        SCF             0.000
    1       5    -2060.16669219030      3.542    0.93627        TDA             0.266
    2       5    -2060.15438116737      3.877    0.63286        TDA             0.601
    3       5    -2060.14129840868      4.233    0.00679        TDA             0.957
    4       5    -2060.14063692088      4.251    0.02222        TDA             0.975
    5       5    -2060.13957119054      4.280    0.61628        TDA             1.004
    6       5    -2060.13832171358      4.314    0.87886        TDA             1.038
    7       5    -2060.12435697115      4.694    0.00113        TDA             1.418
    8       5    -2060.12395272861      4.705    0.28032        TDA             1.429
    9       5    -2060.12185801725      4.762    0.01219        TDA             1.486
   10       5    -2060.11877107418      4.846    0.00003        TDA             1.570
   11       5    -2060.11634561892      4.912    0.01243        TDA             1.636
   12       5    -2060.11590462705      4.924    0.00225        TDA             1.648
   13       5    -2060.11583112841      4.926    0.05664        TDA             1.650
   14       5    -2060.11042897805      5.073    0.03065        TDA             1.797
   15       5    -2060.10917950110      5.107    0.00467        TDA             1.831
   16       5    -2060.10851801330      5.125    0.81624        TDA             1.849
   17       5    -2060.10238087649      5.292    0.05319        TDA             2.016
   18       5    -2060.10102115157      5.329    0.00405        TDA             2.053
   19       5    -2060.09738296868      5.428    0.00923        TDA             2.152
   20       5    -2060.09598649444      5.466    0.00326        TDA             2.190
   21       5    -2060.09367128714      5.529    0.00756        TDA             2.253
   22       5    -2060.09231156222      5.566    0.00653        TDA             2.290
   23       5    -2060.09080484001      5.607    0.00949        TDA             2.331
   24       5    -2060.09076809069      5.608    0.00402        TDA             2.332
   25       5    -2060.08507194575      5.763    0.01869        TDA             2.487
   26       5    -2060.08264649049      5.829    0.01427        TDA             2.553
   27       5    -2060.06949023315      6.187    0.01436        TDA             2.911
   28       5    -2060.06419833075      6.331    0.00118        TDA             3.055
   29       5    -2060.05736295683      6.517    0.07555        TDA             3.241
   30       7    -2060.17162372000      3.408    0.94915        SCF             0.000
   31       7    -2060.15927594775      3.744    0.93597        TDA             0.336
   32       7    -2060.14637693567      4.095    0.93261        TDA             0.687
   33       7    -2060.12476833423      4.683    0.26773        TDA             1.275
   34       7    -2060.12440084100      4.693    0.30968        TDA             1.285
   35       7    -2060.11852094946      4.853    0.61496        TDA             1.445
   36       7    -2060.11705097657      4.893    0.00015        TDA             1.485
   37       7    -2060.11525025978      4.942    0.30531        TDA             1.534
   38       7    -2060.11447852402      4.963    0.00146        TDA             1.555
   39       7    -2060.10429896177      5.240    0.00888        TDA             1.832
   40       7    -2060.10220425041      5.297    0.09174        TDA             1.889
   41       7    -2060.09805157700      5.410    0.00040        TDA             2.002
   42       7    -2060.09441339411      5.509    0.00172        TDA             2.101
   43       7    -2060.09224518410      5.568    0.02113        TDA             2.160
   44       7    -2060.08875399849      5.663    0.03280        TDA             2.255
   45       7    -2060.08787201476      5.687    0.49869        TDA             2.279
   46       7    -2060.08695328171      5.712    0.00422        TDA             2.304
   47       7    -2060.08151438203      5.860    0.02956        TDA             2.452
   48       7    -2060.07890518015      5.931    0.00197        TDA             2.523
   49       7    -2060.07677371946      5.989    0.03448        TDA             2.581
   50       7    -2060.07269454470      6.100    0.02572        TDA             2.692
   51       7    -2060.06953410300      6.186    0.37580        TDA             2.778
   52       7    -2060.06912986045      6.197    0.00396        TDA             2.789
   53       7    -2060.05487112345      6.585    0.03873        TDA             3.177
   54       7    -2060.05420963565      6.603    0.14670        TDA             3.195
   55       7    -2060.04469156121      6.862    0.00065        TDA             3.454
   56       7    -2060.03822368050      7.038    0.01066        TDA             3.630
   57       7    -2060.03579822524      7.104    0.00271        TDA             3.696
   58       7    -2060.01514510618      7.666    0.00638        TDA             4.258
   59       7    -2060.01429987177      7.689    0.00952        TDA             4.281
</pre></div>
</div>
<p><strong>IP-EOM-CCSD</strong>
For IP-EOM-CCSD, only EOM=True is required and the desired basis set. SCF keywords can be provided to aid HF convergence.
Warning: Dysonnorms are approximate as they are simply the dominant coefficient of the singles eigenvector.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">PES</span>

<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;FeS2-tpssh-opt.xyz&quot;</span><span class="p">)</span>
<span class="n">joblabel</span><span class="o">=</span><span class="s2">&quot;FeS2min-IPEOMCCSD&quot;</span>

<span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! def2-TZVP tightscf &quot;</span>
<span class="n">blocks</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">%maxcore</span>
<span class="si">%s</span><span class="s2">cf</span>
<span class="s2">maxiter 500</span>
<span class="s2">directresetfreq 1</span>
<span class="s2">diismaxeq 20</span>
<span class="s2">end</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Define ORCA theory.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms and MO-spectrum</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                      <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">EOM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span>
                        <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>

<span class="c1">#Plotting spectrum with approximate Dysonnorm-intensities as well as MO-spectrum.</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_&#39;</span><span class="o">+</span><span class="n">joblabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
    <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">PES</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>CASSCF</strong></p>
<p>For CASSCF one neads to provide the CAS, CAS_Initial and CAS_Final keywords.
It is possible to provide a %casscf block in the ORCA-object-blocks in order to modify the default.
Below we use the ICE-CI CASSCF variant and we switch from the default convergers to DIIS in order to preserve the chosen active space.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">PES</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">6</span>
<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;FeS2-tpssh-opt.xyz&quot;</span><span class="p">)</span>
<span class="n">joblabel</span><span class="o">=</span><span class="s2">&quot;FeS2min-CASSCF&quot;</span>

<span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! def2-TZVP tightscf &quot;</span>
<span class="n">blocks</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">%maxcore 9000</span>
<span class="si">%c</span><span class="s2">asscf</span>
<span class="s2">cistep ice</span>
<span class="s2">orbstep diis</span>
<span class="s2">switchstep diis</span>
<span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Define ORCA theory.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms and MO-spectrum</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                      <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span>
                        <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">CAS_Initial</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">CAS_Final</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>
                        <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>

<span class="c1">#Plotting spectrum with approximate Dysonnorm-intensities as well as MO-spectrum.</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_&#39;</span><span class="o">+</span><span class="n">joblabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
    <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">PES</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>MRCI+Q</strong></p>
<p>For MRCI+Q one neads to provide the MRCI, MRCI_Initial and MRCI_Final keywords.
It is possible to provide a %casscf block in the ORCA-object-blocks in order to control the default settings of the CASSCF-orbital optimization
performed for the initial state.
Below we switch from the default convergers to DIIS in order to preserve the chosen active space.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ash</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">PES</span>

<span class="n">numcores</span><span class="o">=</span><span class="mi">6</span>
<span class="n">molecule</span><span class="o">=</span><span class="n">Fragment</span><span class="p">(</span><span class="n">xyzfile</span><span class="o">=</span><span class="s2">&quot;FeS2-tpssh-opt.xyz&quot;</span><span class="p">)</span>
<span class="n">joblabel</span><span class="o">=</span><span class="s2">&quot;FeS2min-MRCI+Q&quot;</span>

<span class="nb">input</span><span class="o">=</span><span class="s2">&quot;! def2-TZVP tightscf &quot;</span>
<span class="n">blocks</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">%maxcore</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Define ORCA theory.</span>
<span class="n">ORCAcalc</span> <span class="o">=</span> <span class="n">ORCATheory</span><span class="p">(</span><span class="n">orcasimpleinput</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">orcablocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">numcores</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1">#Calling PhotoElectronSpectrum to get IPs, dysonnorms and MO-spectrum</span>
<span class="n">IPs</span><span class="p">,</span> <span class="n">dysonnorms</span> <span class="o">=</span> <span class="n">PES</span><span class="o">.</span><span class="n">PhotoElectronSpectrum</span><span class="p">(</span><span class="n">theory</span><span class="o">=</span><span class="n">ORCAcalc</span><span class="p">,</span> <span class="n">fragment</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span> <span class="n">InitialState_charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Initialstate_mult</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                      <span class="n">Ionizedstate_charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ionizedstate_mult</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">numionstates</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="n">numcores</span><span class="o">=</span><span class="n">numcores</span><span class="p">,</span>
                        <span class="n">MRCI</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MRCI_Initial</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">MRCI_Final</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>
                        <span class="n">path_wfoverlap</span><span class="o">=</span><span class="s2">&quot;/home/bjornsson/sharc-master/bin/wfoverlap.x&quot;</span> <span class="p">)</span>

<span class="c1">#Plotting spectrum with approximate Dysonnorm-intensities as well as MO-spectrum.</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_Spectrum</span><span class="p">(</span><span class="n">xvalues</span><span class="o">=</span><span class="n">IPs</span><span class="p">,</span> <span class="n">yvalues</span><span class="o">=</span><span class="n">dysonnorms</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="s1">&#39;PES_spectrum_&#39;</span><span class="o">+</span><span class="n">joblabel</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span>
    <span class="n">broadening</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">imageformat</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">PES</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="module_plotting.html" class="btn btn-neutral float-right" title="Plotting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="module_molcrys.html" class="btn btn-neutral float-left" title="MOLCRYS: Automatic QM/MM for Molecular Crystals" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Ragnar Bjornsson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>